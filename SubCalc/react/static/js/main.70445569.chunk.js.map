{"version":3,"sources":["Utilities.ts","Subcaucus.ts","SubCalcPRNG.ts","Snapshot.ts","SubCalc.ts","Loader.tsx","ValueCard.tsx","SubcaucusRowInfoCard.tsx","SubcaucusRow.tsx","App.tsx","ShowJSON.tsx","registerServiceWorker.ts","index.tsx"],"names":["alertFunction","debug","message","isDebugging","_console","_len","arguments","length","optionalParams","Array","_key","console","log","apply","concat","alertUser","error","alert","_len2","_key2","getQueryVariable","variable","vars","window","location","search","substring","split","i","pair","decodeURIComponent","unwrapString","maybeString","empty","undefined","randomSeed","Math","floor","random","String","prototype","trim","str","this","replace","test","charAt","hashCode","hash","charCodeAt","toDate","Date","Number","toCommaString","toString","singularPlural","singular","plural","includeNumber","number","comparisonValue","decimalPlaces","multiple","pow","round","pushUnique","something","indexOf","push","max","reduce","accumulator","current","toTimestampString","toJSON","_tg_counter","now","Subcaucus","init","_this","Object","classCallCheck","name","count","id","delegates","recreate","with","fromJSON","json","decoded","decoder","run","ok","result","_u","defaultName","displayName","viability","baseDelegates","remainder","_tosses","reportTosses","clearDelegateInfo","setViability","delegateScore","coinToss","won","against","tosses","forEach","toss","keys","map","key","addRemainderDelegate","asText","text","object","string","optional","SubCalcPRNG","state1","state2","mod1","mul1","mod2","mul2","record","randomUpTo","limit","abs","randomComparison","recordSummary","summary","r","isNaN","Snapshot","debugID","revision","allowed","subcaucuses","s","join","created","device","revised","seed","changes","TSMap","subcaucus","set","jsub","keyNum","revise","update","redistributeDelegates","clearCounts","sub","room","totalDelegates","wholeViability","viableRoom","delegateViability","subs","values","acc","ceil","vSubs","filter","scRand","vSubRanks","m","temp","sort","a","b","coinFlip","reportingTo","justAddedRemainderDelegate","meetingKey","snapshotKey","nextSubcaucusID","toConsumableArray","addSubcaucus","newID","deleteSubcaucus","delete","sText","parse","toLocaleString","timeZoneName","dict","SubCalc","snapshot","version","storedSnapshotPrefix","trashedSnapshotPrefix","storedSnapshotKey","snapshots","status","localStorage","prefix","storedKey","startsWith","readSnapshot","setSnapshot","write","newSnapshot","duplicateSnapshot","jsonSubCalc","v","jsonSubCalcString","JSON","stringify","setItem","e","Error","writeSnapshot","jsnap","jsnapString","reviseSnapshot","zeroSubcaucuses","saveSnapshot","renameMeeting","trashSnapshot","keyContent","getItem","removeItem","emptyTrash","read","SortOrder","ValueCard","_React$Component","props","possibleConstructorReturn","getPrototypeOf","call","isPositiveInteger","originalValue","value","defaultValue","handleChange","event","currentTarget","num","setState","handleKey","onSave","state","focusOnWholeText","target","setTimeout","setSelectionRange","isEmpty","save","allowEmpty","idPlus","suffix","type","initialValue","inherits","createClass","cardFooter","react","footer","illegallyEmpty","originalIllegallyEmpty","saveButton","primereact_button","label","icon","disabled","onClick","cancelButton","className","extraButtons","card","title","header","image","alt","src","children","description","inputtext","autoComplete","keyfilter","pattern","placeholder","onChange","onKeyUp","autoFocus","React","SubcaucusRowInfoCard","_this$props","dismiss","ValueCard_ValueCard","SubcaucusRow","handleName","currentTabIndex","tabIndex","handleCount","handleBlur","exchange","rows","preventDefault","next","document","querySelectorAll","element","focus","showInfo","_this2","_this$state","infoCard","SubcaucusRowInfoCard_SubcaucusRowInfoCard","inputtextarea","index","cols","onKeyDown","onBlur","onFocus","CardFor","Presenting","Loader","renderMenu","items","command","onLoad","menubar","model","sortOrderIcon","button","sortBy","toggleSortOrder","deleteSnapshot","subcalc","forceUpdate","renderSnapshot","createdDate","year","month","day","revisedString","hour","minute","second","showing","renderSnapshots","sortBySnapshotRevision","comparison","revA","revB","sortBySnapshotName","toUpperCase","renderMeeting","snap","snapshotsJSX","accordion","headerClassName","contentClassName","renderMeetings","currentMeetingKey","tabs","meetingIndex","indexOfCurrent","meetingSnapshots","activeIndex","iconPos","onNew","ShowJSON","jsonString","data","App","callback","keySuffix","initialCardState","WelcomeAndSetName","ChangingDelegates","growl","loadSnapshot","present","Calculator","setStateName","setStateAllowed","setStateSeed","setStateSubcaucuses","newMeeting","cards","duplicateMeeting","growlAlert","toLocaleDateString","allowedString","addCard","cardFor","to","addCardState","removeCard","seekingCardFor","from","foundCardFor","removeCardState","switchCardState","fromCardFor","toCardFor","newCards","showingCard","handleSubcaucusChange","action","removeEmpties","subset","k","RemovingEmpties","order","nextSortOrder","currentOrder","nextOrder","checkForRevisionBefore","afterBefore","SavingSnapshotBefore","ShowingAbout","ShowingInstructions","ShowingSecurity","Loading","SavingSnapshot","ChangingCoin","renderAbout","ShowingBy","href","renderInstructions","renderSecurity","renderBy","renderWelcomeAndSetName","renderChangingName","ChangingName","renderSavingSnapshot","renderSavingSnapshotBefore","nextStepLoading","renderChangingDelegates","renderChangingCoin","renderRemovingEmpties","renderNextCard","sortBySubcaucusName","nameA","nameB","sortName","sortBySubcaucusCounts","sortCount","Infinity","renderSubcaucusRows","None","array","SubcaucusRow_SubcaucusRow","renderSummary","renderCalculator","Ascending","renderByline","renderDebuggingInfo","toLocaleTimeString","ShowJSON_ShowJSON","style","clear","severity","show","closable","detail","Loader_Loader","ref","el","isLocalhost","Boolean","hostname","match","registerValidSW","swUrl","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","catch","ReactDOM","App_App","getElementById","URL","process","origin","addEventListener","fetch","response","headers","get","ready","unregister","reload","checkValidServiceWorker","registerServiceWorker"],"mappings":"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","file":"static/js/main.70445569.chunk.js","sourcesContent":["// Utilities.tsx\n//\n// A number of helpful functions used throughout the app.\n//\n// Recommend this file be imported as:\n// import * as _u from './Utilities'\n//\n// We use the name \"_u\" so that tslint won't complain if we\n// do not actually use any _u functions in our file. This way\n// we still can import the prototype extensions.\n\n// Prototype extensions\n\ndeclare global {\n\n\ttype TimestampString = string\n\ttype ComparisonValue = -1 | 0 | 1\n\n\t// about extending classes\n\t// see: https://stackoverflow.com/a/53392268/383737\n\n\tinterface String {\n\t\ttrim(): string\n\t\thashCode(): number\n\t\ttoDate(): Date\n\t}\n\n\tinterface Number {\n\t\ttoCommaString(): string\n\t\tsingularPlural(singular: string, plural: string): string\n\t\tcomparisonValue(): ComparisonValue\n\t\tdecimalPlaces(decimalPlaces: number): number\n\t}\n\n\tinterface Array<T> {\n\t\tpushUnique(something: T): Array<T>\n\t\tmax(): number\n\t}\n\n\t/**\n\t * Converts a date to our typical timestamp string,\n\t * which is really just JSON format with a type to be clearer.\n\t */\n\tinterface Date {\n\t\ttoTimestampString(): TimestampString\n\t}\n\n}\n\n// see http://blog.stevenlevithan.com/archives/faster-trim-javascript\nString.prototype.trim = function (): string {\n\tvar str = this.replace(/^\\s+/, '')\n\tfor (var i = str.length - 1; i >= 0; i--) {\n\t\tif (/\\S/.test(str.charAt(i))) {\n\t\t\tstr = str.substring(0, i + 1)\n\t\t\tbreak\n\t\t}\n\t}\n\treturn str\n}\n\n// https://stackoverflow.com/a/7616484\nString.prototype.hashCode = function (): number {\n\tlet hash = 0\n\tif (this.length === 0) return hash;\n\tfor (let i = 0; i < this.length; i++) {\n\t\tlet chr = this.charCodeAt(i);\n\t\thash = ((hash << 5) - hash) + chr;\n\t\thash |= 0; // Convert to 32bit integer\n\t}\n\treturn hash;\n}\n\nString.prototype.toDate = function (): Date {\n\treturn new Date(String(this))\n}\n\n// see: https://stackoverflow.com/a/2901298\nNumber.prototype.toCommaString = function (): string {\n\treturn this.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n}\n\nNumber.prototype.singularPlural = function (singular: string, plural: string, includeNumber?: 'no number'): string {\n\tconst number = includeNumber != 'no number' ? `${this} ` : ''\n\treturn `${number}${this == 1 ? singular : plural}`\n}\n\nNumber.prototype.comparisonValue = function (): ComparisonValue {\n\tif (this < 0) return -1\n\tif (this > 0) return 1\n\treturn 0\n}\n\nNumber.prototype.decimalPlaces = function (decimalPlaces: number) {\n\tconst multiple = Math.pow(10, decimalPlaces)\n\treturn Math.round(Number(this) * multiple) / multiple\n}\n\n// see: https://stackoverflow.com/a/12803141\nArray.prototype.pushUnique = function (something) {\n\tif (this.indexOf(something) === -1) {\n\t\tthis.push(something)\n\t}\n\treturn this\n}\n\nArray.prototype.max = function (): number {\n\treturn this.reduce((accumulator, current) => {\n\t\treturn Math.max(accumulator, current)\n\t})\n}\n\n/**\n * Converts a date to our typical timestamp string,\n * which is really just JSON format with a type to be clearer.\n */\nDate.prototype.toTimestampString = function (): TimestampString {\n\treturn this.toJSON()\n}\n\n// _u functions\n\n/**\n * _u.debug\n * \n * Pass along message and optionalParams to console.log\n * only if we are in a development environment.\n * \n */\nexport function debug(message?: any, ...optionalParams: any[]) {\n\tif (isDebugging()) {\n\t\tconsole.log(message, ...optionalParams)\n\t}\n}\n\nvar alertFunction: ((message: string) => void)\n\nexport function setAlertFunction(callback: ((message: string) => void)) {\n\talertFunction = callback\n}\n\nexport function alertUser(error: Error, ...optionalParams: any[]) {\n\tif (alertFunction) {\n\t\talertFunction(error.message)\n\t} else {\n\t\talert(error.message)\n\t}\n\tdebug(error, ...optionalParams)\n}\n\nexport function isDebugging(): boolean {\n\treturn !process.env.NODE_ENV || process.env.NODE_ENV === \"development\" || getQueryVariable(\"debug\") === \"yes\"\n}\n\nexport function isApp(): boolean {\n\treturn getQueryVariable(\"app\") === \"yes\"\n}\n\nexport function getQueryVariable(variable: string) {\n\tvar query = window.location.search.substring(1);\n\tvar vars = query.split('&');\n\tfor (var i = 0; i < vars.length; i++) {\n\t\tvar pair = vars[i].split('=');\n\t\tif (decodeURIComponent(pair[0]) == variable) {\n\t\t\treturn decodeURIComponent(pair[1]);\n\t\t}\n\t}\n\treturn undefined\n}\n\n/**\n * Unwrap the optional string, returning '' if it was undefined.\n * \n * @param {string | undefined} maybeString\n * @param {string} empty An alternative string to return if the input was undefined.\n */\nexport function unwrapString(maybeString?: string, empty = ''): string {\n\tif (maybeString == undefined) return empty\n\treturn maybeString\n}\n\n/**\n * Unwrap the optional number, returning 0 if it was undefined.\n * \n * @param {string | undefined} maybeNumber\n * @param {string} empty An alternative number to return if the input was undefined.\n */\nexport function unwrapNumber(maybeNumber?: number, empty = 0): number {\n\tif (maybeNumber == undefined) return empty\n\treturn maybeNumber\n}\n\n/**\n * Unwrap the optional boolean, returning false if it was undefined.\n * \n * @param {string | undefined} maybeBoolean\n * @param {string} empty An alternative boolean value to return if the input was undefined.\n */\nexport function unwrapBoolean(maybeBoolean?: boolean, empty = false): boolean {\n\tif (maybeBoolean == undefined) return empty\n\treturn maybeBoolean\n}\n\n/**\n * A random number provided by Math.random() to use as a seed\n * for our own random number sequences.\n * \n * Note that in SubCalc1 we used seconds from Unix epoch as seeds,\n * but that makes it somewhat confusing by implying a connection between\n * the time and the seed. There really is no such connection.\n */\nexport function randomSeed(): number {\n\treturn Math.floor(Math.random() * 1000000)\n}\n\n/**\n * Provides a uniqueNumber, simply counting up each time a number is provided.\n */\nlet _tg_counter = 0\nexport function uniqueNumber(): number {\n\treturn _tg_counter++\n}\n\n/**\n * Returns the TimestampString of the current time.\n */\nexport function now(): TimestampString {\n\treturn (new Date()).toTimestampString()\n}","// we will need a way to type validate the json we import\n// see https://github.com/mojotech/json-type-validation\n// or maybe just use a JSON.parse reviver to type the data\n\n// see: https://github.com/mojotech/json-type-validation\nimport { Decoder, object, string, optional, number, boolean } from '@mojotech/json-type-validation'\n\n// local to this app\nimport * as _u from './Utilities'\n\ndeclare global {\n\n\tinterface SubcaucusInitializer {\n\t\tid: number\n\t\twith?: Partial<SubcaucusJSON>\n\t\tjson?: SubcaucusJSON\n\t}\n\n\tinterface SubcaucusJSON {\n\t\tname: string\n\t\tcount: number\n\t\tdelegates?: number\n\t}\n\n}\n\nexport class Subcaucus {\n\n\tdebug = (): string => {\n\t\treturn `${this.name} (${this.count})`\n\t}\n\treadonly id: number\n\tname: string\n\tcount: number\n\tdelegates: number\n\n\tstatic decoder: Decoder<SubcaucusJSON> = object({\n\t\tname: string(),\n\t\tcount: number(),\n\t\tdelegates: optional(number())\n\t})\n\n\t/**\n\t * Creates a new subcacucus instance.\n\t * \n\t * ```typescript\n\t * interface SubcaucusInitializer {\n\t *   id: number\n\t *   with?: {\n\t *     name?: string\n\t *     count?: number\n\t * \t   delegates?: number\n\t *   }\n\t *   json?: SubcaucusJSON\n\t * }\n\t * ```\n\t * @param {SubcaucusInitializer} init\n\t */\n\tconstructor(init: SubcaucusInitializer) {\n\t\tthis.id = init.id\n\n\t\tthis.name = ''\n\t\tthis.count = 0\n\t\tthis.delegates = 0\n\n\t\tif (init.with) {\n\t\t\tthis.name = init.with[\"name\"] || this.name\n\t\t\tthis.count = init.with[\"count\"] || this.count\n\t\t\tthis.delegates = init.with[\"delegates\"] || this.delegates\n\t\t}\n\n\t\tif (init.json) {\n\t\t\tthis.fromJSON(init.json)\n\t\t}\n\t}\n\n\trecreate = (): Subcaucus => {\n\t\treturn new Subcaucus({\n\t\t\tid: this.id,\n\t\t\twith: {\n\t\t\t\tname: this.name,\n\t\t\t\tcount: this.count,\n\t\t\t\tdelegates: this.delegates,\n\t\t\t}\n\t\t})\n\t}\n\n\ttoJSON = (): SubcaucusJSON => {\n\t\treturn {\n\t\t\tname: this.name,\n\t\t\tcount: this.count\n\t\t}\n\t}\n\n\tfromJSON = (json: SubcaucusJSON) => {\n\t\tconst decoded = Subcaucus.decoder.run(json)\n\n\t\tif (decoded.ok) {\n\t\t\tthis.name = decoded.result.name\n\t\t\tthis.count = decoded.result.count\n\t\t\tthis.delegates = decoded.result.delegates || 0\n\t\t} else {\n\t\t\t_u.debug(decoded.error)\n\t\t}\n\t}\n\n\tdefaultName = () => {\n\t\treturn `Subcaucus ${this.id}`\n\t}\n\n\tdisplayName = () => {\n\t\treturn this.name || this.defaultName()\n\t}\n\n\t/**\n\t * The viability number provided by the snapshot.\n\t * This is the `delegateViability` number.\n\t */\n\tviability = 0\n\n\t/**\n\t * The number of delegates based on the simple viability number,\n\t * before any remainders have been considered.\n\t */\n\tbaseDelegates = 0\n\n\t/**\n\t * The remainder left after apportioning base delegates.\n\t */\n\tremainder = 0\n\n\t/**\n\t * Reported coin toss results.\n\t */\n\tprivate _tosses: Array<{ won: boolean, against: Subcaucus }> = []\n\n\t/**\n\t * This will flag subcaucuses which should report out\n\t * the details of their coin tosses.\n\t */\n\treportTosses = false\n\n\t/**\n\t * Clear all delegate calculation-related variables\n\t * in preparation for a recalculation.\n\t */\n\tclearDelegateInfo = () => {\n\t\tthis.delegates = 0\n\t\tthis.viability = 0\n\t\tthis.baseDelegates = 0\n\t\tthis.remainder = 0\n\t\tthis.reportTosses = false\n\t\tthis._tosses = []\n\t}\n\n\t/**\n\t * Set the internal viability number and calculate base delegates\n\t * and remainder values.\n\t */\n\tsetViability = (viability: number) => {\n\t\tthis.viability = viability\n\t\tconst delegateScore = this.count / this.viability\n\t\tthis.baseDelegates = Math.floor(delegateScore)\n\t\tthis.delegates = this.baseDelegates\n\t\tthis.remainder = delegateScore - this.baseDelegates\n\t}\n\n\t/**\n\t * Report coin tosses to the subcaucus.\n\t */\n\tcoinToss = (won: boolean, against: Subcaucus) => {\n\t\tthis._tosses.push({ won: won, against: against })\n\t}\n\n\t/**\n\t * An array of the last toss exchanged with each opponent subcaucus.\n\t */\n\ttosses = (): Array<{ won: boolean, against: Subcaucus }> => {\n\t\t// return an empty array if we are not to be reporting any tosses\n\t\tif (!this.reportTosses) return []\n\n\t\t// we only want to convey the result of the last toss between two partners\n\t\tlet tosses: { [props: string]: { won: boolean, against: Subcaucus } } = {}\n\t\tthis._tosses.forEach((toss) => {\n\t\t\ttosses[String(toss.against.id)] = toss\n\t\t})\n\t\treturn Object.keys(tosses).map((key) => tosses[key])\n\t}\n\n\t/**\n\t * Add a delegate due to the remainder allocations.\n\t */\n\taddRemainderDelegate = () => {\n\t\tthis.delegates++\n\t}\n\n\t/**\n\t * A textual representation of the subcaucus.\n\t */\n\tasText = (): string => {\n\t\tlet text = ''\n\n\t\tif (!this.name && !this.count) return text\n\n\t\ttext += this.displayName() + \": \"\n\n\t\ttext += this.count.singularPlural(\"member\", \"members\")\n\n\t\tif (this.delegates === 0) {\n\t\t\ttext += \" in a non-viable subcaucus.\"\n\t\t\treturn text\n\t\t}\n\n\t\ttext += \" may elect \" + this.delegates.singularPlural(\"delegate\", \"delegates\")\n\n\t\tif (this.remainder) {\n\t\t\ttext += \" (\"\n\n\t\t\tif (this.remainder) {\n\t\t\t\ttext += \"remainder \" + this.remainder.decimalPlaces(3)\n\t\t\t}\n\n\t\t\tthis.tosses().forEach((toss) => {\n\t\t\t\ttext += \", \" + (toss.won ? \"won\" : \"lost\") + \" vs \" + toss.against.displayName()\n\t\t\t})\n\n\t\t\tif (this.delegates > this.baseDelegates) {\n\t\t\t\ttext += \", awarded a remainder delegate\"\n\t\t\t}\n\n\t\t\ttext += \")\"\n\t\t}\n\n\t\treturn text + \".\"\n\t}\n\n}","import { number } from \"@mojotech/json-type-validation\";\n\n/**\n * SubCalcPRNG.ts\n *\n * Manages the generation of random numbers.\n *\n * Our random numbers, like most computed random numbers,\n * are not actually random, but rather \"psedo-random\".\n * We just need numbers that are random enough to be a\n * fair approximation of the coin flips in the walking\n * subcaucus process.\n *\n * We do this ourselves so that we know exactly how the\n * numbers were generated and can replicate the exact same\n * \"random\" results on other platforms or when we retrieve\n * caucus information in the future. We do not actually store\n * the computed caucus results, after all, so we need to be\n * able to reliably reproduce them in the future. This means\n * our random numbers need to be predictable and reproducable.\n * \n * This class is based on http://stackoverflow.com/a/22313621/383737\n * but modified to accept strings and turn them into numbers.\n */;\n\n/**\n * Manages the generation of random numbers.\n */\nexport class SubCalcPRNG {\n\n\tmod1 = 4294967087\n\tmul1 = 65539\n\tmod2 = 4294965887\n\tmul2 = 65537\n\tstate1 = 0\n\tstate2 = 0\n\n\t/**\n\t * Can be called with no arguments in order to seed \n\t * the PRNG with the current time, or it can \n\t * be called with either 1 or 2 non-negative integers as arguments \n\t * in order to seed it with those integers. Due to float point \n\t * accuracy seeding with only 1 value will only allow the generator \n\t * to be initiated to one of 2^53 different states.\n\t * \n\t * For convenience, strings supplied to parameters will be \n\t * converted to numbers and all numbers will be converted to\n\t * positive integers.\n\t * \n\t * @param state1 will default to seconds since Unix epoch\n\t * @param state2 will default to value of seed1\n\t */\n\tconstructor(state1: string | number, state2?: string | number) {\n\n\t\tthis.state1 = Math.abs(Math.floor(Number(state1)))\n\t\tthis.state2 = Math.abs(Math.floor(Number(state2)))\n\n\t\tif (isNaN(this.state1) || this.state1 < 1) {\n\t\t\tthis.state1 = Number(new Date())\n\t\t}\n\t\tif (isNaN(this.state2) || this.state2 < 1) {\n\t\t\tthis.state2 = this.state1\n\t\t}\n\t\tthis.state1 = this.state1 % (this.mod1 - 1) + 1\n\t\tthis.state2 = this.state2 % (this.mod2 - 1) + 1\n\t}\n\n\trecord: Array<{ limit: number, result: number }> = []\n\n\t/**\n\t * This PRNG function takes 1 integer limit argument which\n\t * must be in the range 1 to 4294965886. It will return a \n\t * number in the range 0 to limit-1.\n\t * \n\t * For convenience, all numbers will be converted to\n\t * positive integers.\n\t * \n\t * @param limit constrains the result between 0 and limit-1\n\t */\n\trandomUpTo = (limit: number): number => {\n\n\t\tlimit = Math.abs(Math.floor(limit))\n\n\t\tthis.state1 = (this.state1 * this.mul1) % this.mod1\n\t\tthis.state2 = (this.state2 * this.mul2) % this.mod2\n\n\t\tif (\n\t\t\tthis.state1 < limit\n\t\t\t&& this.state2 < limit\n\t\t\t&& this.state1 < this.mod1 % limit\n\t\t\t&& this.state2 < this.mod2 % limit\n\t\t) {\n\t\t\treturn this.randomUpTo(limit)\n\t\t}\n\n\t\tconst result = (this.state1 + this.state2) % limit\n\t\tthis.record.push({ limit: limit, result: result })\n\t\treturn result\n\t}\n\n\t/**\n\t * Like Math.random, this returns a random number\n\t * between 0 and 1.\n\t */\n\trandom = (): number => {\n\t\tconst limit = 4294965885\n\t\treturn this.randomUpTo(limit) / limit\n\t}\n\n\t/**\n\t * This function \"flips a coin\" and returns either \n\t * heads (1) or tails (-1). It is designed for use\n\t * in sorting to produce a random order.\n\t */\n\trandomComparison = (): -1 | 1 => {\n\t\treturn this.randomUpTo(2) ? -1 : 1\n\t}\n\n\trecordSummary = (): { [limit: string]: { [result: string]: number } } => {\n\t\tconst summary: { [limit: string]: { [result: string]: number } } = {}\n\n\t\tthis.record.forEach((r) => {\n\t\t\tlet limit = summary[String(r.limit)]\n\t\t\tif (limit === undefined) {\n\t\t\t\tlimit = {}\n\t\t\t}\n\t\t\tif (limit[String(r.result)] === undefined) {\n\t\t\t\tlimit[String(r.result)] = 1\n\t\t\t} else {\n\t\t\t\tlimit[String(r.result)]++\n\t\t\t}\n\t\t\tsummary[String(r.limit)] = limit\n\t\t})\n\n\t\treturn summary\n\t}\n}","/**\n * Snapshot.ts\n * \n * Holds all the information for a single snapshot.\n * Handles the calculation of delegates for a snapshot.\n * Handles conversion to and from JSON.\n */\n\n// see https://github.com/ClickSimply/typescript-map\nimport { TSMap } from 'typescript-map'\n\n// see: https://github.com/mojotech/json-type-validation\nimport { Decoder, object, string, number, dict } from '@mojotech/json-type-validation'\n\n// local to this app\nimport * as _u from './Utilities'\nimport { Subcaucus } from './Subcaucus'\nimport { SubCalcPRNG } from './SubCalcPRNG'\n\ndeclare global {\n\n\tinterface SnapshotInitializer {\n\t\tdevice: number\n\t\tcreated: TimestampString\n\t\twith?: {\n\t\t\trevised?: TimestampString\n\t\t\trevision?: string\n\t\t\tname?: string\n\t\t\tallowed?: number\n\t\t\tseed?: number\n\t\t\tsubcaucuses?: TSMap<number, Subcaucus>\n\t\t},\n\t\tjson?: SnapshotJSON\n\t}\n\n\tinterface SnapshotJSON {\n\t\tdevice: number\n\t\tcreated: TimestampString\n\t\trevised: TimestampString\n\t\trevision: string\n\t\tname: string\n\t\tallowed: number\n\t\tseed: number\n\t\tsubcaucuses: { [id: string]: SubcaucusJSON }\n\t}\n\n}\n\nexport class Snapshot {\n\n\tdebugID = ` ------ ${_u.uniqueNumber()} ------ `\n\tdebug = (): string => {\n\t\treturn \"\\nSnapshot\" + this.debugID + \"\\n\"\n\t\t\t+ this.name + \"/\" + this.revision + \"/\" + this.allowed\n\t\t\t+ \" \" + this.subcaucuses.map((s) => s.debug()).join(\", \")\n\t}\n\tcreated: TimestampString\n\tdevice: number\n\trevised: TimestampString\n\trevision: string\n\tname: string\n\tallowed: number\n\tseed: number\n\tsubcaucuses: TSMap<number, Subcaucus>\n\tchanges = 0\n\n\tstatic decoder: Decoder<SnapshotJSON> = object({\n\t\tdevice: number(),\n\t\tcreated: string(),\n\t\trevised: string(),\n\t\trevision: string(),\n\t\tname: string(),\n\t\tallowed: number(),\n\t\tseed: number(),\n\t\tsubcaucuses: dict(Subcaucus.decoder)\n\t})\n\n\t/**\n\t * Creates a new snapshot instance.\n\t * \n\t * ```typescript\n\t * interface SnapshotInitializer {\n\t *   device: number\n\t *   created: TimestampString\n\t *   with?: {\n\t * \t   revised?: TimestampString\n\t * \t   revision?: string\n\t * \t   name?: string\n\t * \t   allowed?: number\n\t * \t   seed?: number\n\t * \t   subcaucuses?: TSMap<number, Subcaucus>\n\t *   }\n\t *   json?: SnapshotJSON\n\t * }\n\t * ```\n\t * \n\t * @param {SnapshotInitializer} init\n\t */\n\tconstructor(init: SnapshotInitializer) {\n\t\tthis.created = init.created\n\t\tthis.device = init.device\n\t\tthis.revised = _u.now()\n\t\tthis.revision = ''\n\t\tthis.name = ''\n\t\tthis.allowed = 0\n\t\tthis.seed = _u.randomSeed()\n\t\tthis.subcaucuses = new TSMap<number, Subcaucus>()\n\n\t\tif (init.with) {\n\t\t\tthis.revised = init.with[\"revised\"] || this.revised\n\t\t\tthis.revision = init.with[\"revision\"] || this.revision\n\t\t\tthis.name = init.with[\"name\"] || this.name\n\t\t\tthis.allowed = init.with[\"allowed\"] || this.allowed\n\t\t\tthis.seed = init.with[\"seed\"] || this.seed\n\t\t\tif (init.with[\"subcaucuses\"]) {\n\t\t\t\tthis.subcaucuses = init.with[\"subcaucuses\"]\n\t\t\t}\n\t\t}\n\n\t\tif (init.json) {\n\t\t\tthis.fromJSON(init.json)\n\t\t}\n\n\t}\n\n\t/**\n\t * Provide a copy of this instance of a snapshot,\n\t * including deep copies of the subcaucuses.\n\t * \n\t * See: https://www.nickang.com/how-to-clone-class-instance-javascript/\n\t */\n\trecreate = (): Snapshot => {\n\t\t// TSMap clones break classes and don't go deep enough\n\t\t// so we loop through and recreate subcaucuses\n\t\tlet subcaucuses = new TSMap<number, Subcaucus>()\n\t\tthis.subcaucuses.forEach((subcaucus) => {\n\t\t\tsubcaucuses.set(subcaucus.id, subcaucus.recreate())\n\t\t})\n\t\treturn new Snapshot({\n\t\t\tdevice: this.device,\n\t\t\tcreated: this.created,\n\t\t\twith: {\n\t\t\t\trevised: this.revised,\n\t\t\t\trevision: this.revision,\n\t\t\t\tname: this.name,\n\t\t\t\tallowed: this.allowed,\n\t\t\t\tseed: this.seed,\n\t\t\t\tsubcaucuses: subcaucuses\n\t\t\t}\n\t\t})\n\t}\n\n\t/**\n\t * Return a JSON object version of the data in this\n\t * class wants to share.\n\t */\n\ttoJSON = (): {\n\t\tcreated: TimestampString\n\t\tdevice: number\n\t\trevised: TimestampString\n\t\trevision: string\n\t\tname: string\n\t\tallowed: number\n\t\tseed: number\n\t\tsubcaucuses: any\n\t} => {\n\t\treturn {\n\t\t\tcreated: this.created,\n\t\t\tdevice: this.device,\n\t\t\trevised: this.revised,\n\t\t\trevision: this.revision,\n\t\t\tname: this.name,\n\t\t\tallowed: this.allowed,\n\t\t\tseed: this.seed,\n\t\t\tsubcaucuses: this.subcaucuses.toJSON(),\n\t\t}\n\t}\n\n\tfromJSON = (json: SnapshotJSON) => {\n\t\tconst decoded = Snapshot.decoder.run(json)\n\n\t\tif (decoded.ok) {\n\t\t\tthis.created = decoded.result.created\n\t\t\tthis.device = decoded.result.device\n\t\t\tthis.revised = decoded.result.revised\n\t\t\tthis.revision = decoded.result.revision\n\t\t\tthis.name = decoded.result.name\n\t\t\tthis.allowed = decoded.result.allowed\n\t\t\tthis.seed = decoded.result.seed\n\t\t\tthis.subcaucuses = new TSMap<number, Subcaucus>()\n\t\t\tObject.keys(decoded.result.subcaucuses).forEach((key) => {\n\t\t\t\tconst jsub = decoded.result.subcaucuses[key]\n\t\t\t\tconst keyNum = Number(key)\n\t\t\t\tthis.subcaucuses.set(keyNum, new Subcaucus({\n\t\t\t\t\tid: keyNum,\n\t\t\t\t\tjson: jsub\n\t\t\t\t}))\n\t\t\t})\n\t\t} else {\n\t\t\t_u.debug(decoded.error)\n\t\t}\n\t}\n\n\t/**\n\t * Update the snapshot with new values. \n\t * If signalling a change to subcaucuses\n\t * just send without any update.\n\t * \n\t * Revising the snapshot forces a \n\t * redistribution of delegates.\n\t */\n\trevise = (update?: {\n\t\tname?: string,\n\t\tallowed?: number,\n\t\tseed?: number,\n\t}) => {\n\t\t// we mark the snapshot as revised even if no updates were sent\n\t\t// because it may be a signal that the subcaucuses changed\n\t\tthis.revised = _u.now()\n\t\tthis.revision = \"\"\n\t\tif (update) {\n\t\t\tif (update.name) {\n\t\t\t\tthis.name = update.name\n\t\t\t}\n\t\t\tif (update.allowed) {\n\t\t\t\tthis.allowed = update.allowed\n\t\t\t}\n\t\t\tif (update.seed) {\n\t\t\t\tthis.seed = update.seed\n\t\t\t}\n\t\t}\n\t\tthis.redistributeDelegates()\n\t}\n\n\tclearCounts = () => {\n\t\tthis.revised = _u.now()\n\t\tthis.revision = \"\"\n\t\tthis.subcaucuses.forEach((sub) => {\n\t\t\tsub.count = 0\n\t\t})\n\t\tthis.redistributeDelegates()\n\t}\n\n\t/**\n\t * The number of people \"in the room\"\n\t * (the total of subcaucus counts).\n\t */\n\troom = 0\n\n\t/**\n\t * The total number of delegates allocated.\n\t */\n\ttotalDelegates = 0\n\n\t/**\n\t * The number of people in the room divided by the number of delegates allowed.\n\t */\n\tviability = 0\n\n\t/**\n\t * The number of members a subcaucus must have to be viable.\n\t */\n\twholeViability = 0\n\n\t/**\n\t * The number of people who are members of viable subcaucuses\n\t */\n\tviableRoom = 0\n\n\t/**\n\t * The total number of people who are members of viable subcaucuses\n\t * divided by the number of delegates allowed.\n\t */\n\tdelegateViability = 0\n\n\t/**\n\t * Recalculate the delegate numbers for this snapshot.\n\t */\n\tredistributeDelegates = () => {\n\t\t_u.debug(\"Distributing delegates\");\n\n\t\tif (!this.allowed) return\n\n\t\tconst subs = this.subcaucuses.values()\n\n\t\tlet scIncludeRemainderStatement = false; // will be set true if there is a coin flip\n\n\t\t// first clear out all the delegate information\n\t\tsubs.forEach((s) => s.clearDelegateInfo())\n\n\t\t// \"Step No. 1: Add up the total number of members of all the subcaucuses.\" (room)\n\t\tthis.room = subs.reduce((acc, sub) => {\n\t\t\treturn acc + sub.count\n\t\t}, 0)\n\n\t\tif (!this.room) return\n\n\t\t// \"Step No. 2: Divide the result of Step No. 1\" (room)\n\t\t// \"by the total number of delegates to be elected,\" (allowed)\n\t\t// \"round the result up to the next whole number.\" (wholeViability)\n\t\t// \"This is the viability number.\" \n\t\t// (this contradicts the example, which uses viability rather than wholeViability)\n\n\t\tthis.viability = this.room / this.allowed\n\t\tthis.wholeViability = Math.ceil(this.viability)\n\n\t\t// determine which subcaucuses are viable (viabilityScore >= 1)\n\t\t// and calculate the total number viable people in the room (viableRoom)\n\n\t\tconst vSubs = subs.filter((s) => s.count >= this.wholeViability)\n\t\tthis.viableRoom = vSubs.reduce((acc, sub) => {\n\t\t\treturn acc + sub.count\n\t\t}, 0)\n\n\t\tif (!this.viableRoom) return\n\n\t\t// recalculate the viability number for the delegate allocation process\n\t\tthis.delegateViability = this.viableRoom / this.allowed;\n\n\t\t// calculate how many delegates each viable subcaucus gets\n\t\tvSubs.forEach((s) => s.setViability(this.delegateViability))\n\n\t\t// and add up the number of delegates assigned\n\t\tthis.totalDelegates = vSubs.reduce((acc, sub) => {\n\t\t\treturn acc + sub.baseDelegates\n\t\t}, 0)\n\n\t\t// now sort and assign the remainders\n\n\t\t// seed a new random number generator so that we get consistent random results\n\t\tconst scRand = new SubCalcPRNG(this.seed)\n\n\t\tlet vSubRanks = vSubs.map((s) => s.id)\n\n\t\t// see: https://bost.ocks.org/mike/shuffle/\n\t\t// and: https://stackoverflow.com/a/2450976\n\t\tlet m = vSubRanks.length\n\n\t\t// While there remain elements to shuffle\n\t\twhile (m) {\n\t\t\t// Pick a remaining element\n\t\t\tconst i = scRand.randomUpTo(m--)\n\n\t\t\t// And swap it with the current element.\n\t\t\tconst temp = vSubRanks[m]\n\t\t\tvSubRanks[m] = vSubRanks[i]\n\t\t\tvSubRanks[i] = temp\n\t\t}\n\n\t\t// sort the subcaucuses into remainder order with highest remainders first\n\t\tvSubs.sort((a, b) => {\n\t\t\tif (a.remainder > b.remainder) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\telse if (a.remainder < b.remainder) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\t// at this point we have a tie of remainders, so we have to \"flip a coin\"\n\n\t\t\t/*\tA note about \"coin-flips\" or \"drawing lots\"...\n\t\t\n\t\t\t\tTraditionally, when there are delegates remaining to be assigned and\n\t\t\t\ttwo subcaucuses are \"tied\" with the same size delegations, the chair\n\t\t\t\tof the caucus will use some method of assigning those remaining delegates\n\t\t\t\tat random. These methods include coin-flips or drawing lots.\n\t\t\n\t\t\t\tIn this program we accomplish the same randomness, but we do so by first\n\t\t\t\tbuilding this \"rank order\" for remainders to be assigned. It is as though\n\t\t\t\twe flipped the coins before we had a tie and just said that in the event of\n\t\t\t\ta tie we will assign delegates in this (predetermined but random) order.\n\t\t\n\t\t\t\tHowever, since it is possible for this order to shift each time the calculation\n\t\t\t\tis run, it could be that the exact same set of counts for subcaucuses could result\n\t\t\t\tin slightly different delegate assignments from time to time.\n\t\t\t \n\t\t\t\tAt this point in the code, we've determined that two delegation have\n\t\t\t\tthe exact same amount of \"remainder\". The next line of code flips the\n\t\t\t\tcoin to predetermine the order in which these two delegations will be\n\t\t\t\tassigned delegates.\n\t\t\t*/\n\n\t\t\tconst coinFlip = vSubRanks.indexOf(a.id) < vSubRanks.indexOf(b.id) ? -1 : 1\n\n\t\t\t// report the coin flip to each subcaucus\n\t\t\ta.coinToss(coinFlip === -1, b)\n\t\t\tb.coinToss(coinFlip === 1, a)\n\n\t\t\t// return the coin flip as the result of this comparison\n\t\t\treturn (coinFlip);\n\t\t})\n\n\t\t// walk though the now-ranked subcaucuses to assign any remainders\n\t\t// this would be much simpler, exept we want to keep track of who\n\t\t// will really need to know details about tosses.\n\t\tlet remainder = -1\n\t\tlet reportingTo: Array<Subcaucus> = []\n\t\tlet justAddedRemainderDelegate = false\n\t\tvSubs.forEach((s) => {\n\t\t\tif (this.totalDelegates < this.allowed) {\n\t\t\t\tthis.totalDelegates++\n\t\t\t\ts.addRemainderDelegate()\n\t\t\t\tjustAddedRemainderDelegate = true\n\t\t\t\tif (remainder != s.remainder) {\n\t\t\t\t\t// this means that all of the previous\n\t\t\t\t\t// remainder were assigned remainder delegates\n\t\t\t\t\t// so we don't have to report coin tosses\n\t\t\t\t\treportingTo = []\n\t\t\t\t\tremainder = s.remainder\n\t\t\t\t}\n\t\t\t\treportingTo.push(s)\n\t\t\t} else {\n\t\t\t\tif (remainder == s.remainder) {\n\t\t\t\t\treportingTo.push(s)\n\t\t\t\t} else {\n\t\t\t\t\tif (justAddedRemainderDelegate) {\n\t\t\t\t\t\t// since the last remainder that got\n\t\t\t\t\t\t// a remainder delegate was not the same\n\t\t\t\t\t\t// as this remainder, it means there was\n\t\t\t\t\t\t// no contest between equal remainders,\n\t\t\t\t\t\t// so we don't have to report coin tosses\n\t\t\t\t\t\treportingTo = []\n\t\t\t\t\t}\n\t\t\t\t\tremainder = -1\n\t\t\t\t}\n\t\t\t\tjustAddedRemainderDelegate = false\n\t\t\t}\n\t\t})\n\t\t// those subcaucuses left in the report remainder list\n\t\t// should eventually report their coin tosses\n\t\treportingTo.forEach((s) => {\n\t\t\ts.reportTosses = true\n\t\t})\n\n\t\tconsole.log(\"random summary\", scRand.recordSummary())\n\n\t\tthis.changes++ // this is used to help refresh component keys\n\n\t}\n\n\t/**\n\t * Derive the appropriate meeting key from\n\t * the data in this snapshot.\n\t */\n\tmeetingKey = (): string => {\n\t\treturn `${this.created} ${this.device}`\n\t}\n\n\t/**\n\t * Derive the appropriate snapshot key from\n\t * the data in this snapshot.\n\t */\n\tsnapshotKey = (): string => {\n\t\treturn `${this.created} ${this.device} ${this.revised}`\n\t}\n\n\t/**\n\t * The next ID in use for subcacuses in this snapshot.\n\t * \n\t * One more than the current maximum ID.\n\t */\n\tnextSubcaucusID = (): number => {\n\t\tif (this.subcaucuses.length === 0) {\n\t\t\treturn 1\n\t\t}\n\t\tconst max = Math.max(...this.subcaucuses.keys())\n\t\treturn max + 1\n\t}\n\n    /**\n     * Add a subcaucus (empty by default).\n     */\n\taddSubcaucus = (name = '', count = 0, delegates = 0) => {\n\t\tconst newID = this.nextSubcaucusID()\n\t\tthis.subcaucuses.set(newID, new Subcaucus({\n\t\t\tid: newID,\n\t\t\twith: {\n\t\t\t\tname: name,\n\t\t\t\tcount: count,\n\t\t\t\tdelegates: delegates\n\t\t\t}\n\t\t}))\n\t}\n\n\t/**\n\t * Delete a subcaucus from this snapshot.\n\t */\n\tdeleteSubcaucus = (id: number) => {\n\t\tthis.subcaucuses.delete(id)\n\t}\n\n\t/**\n\t * A textual representation of the state of this snapshot.\n\t */\n\tasText = (): string => {\n\t\tlet text = \"\"\n\n\t\ttext += `${this.name} ${this.revision ? `(${this.revision}) ` : ''}was allowed ${this.allowed.singularPlural(\"delegate\", \"delegates\")}.\\n\\n`\n\n\t\tif (this.room > 0) {\n\n\t\t\tthis.subcaucuses.forEach((subcaucus) => {\n\t\t\t\tconst sText = subcaucus.asText()\n\t\t\t\ttext += sText ? sText + \"\\n\\n\" : ''\n\t\t\t})\n\n\t\t\ttext += `${this.room.singularPlural(\"person was\", \"people were\")} participating, the initial viability number was ${this.viability.decimalPlaces(3)}. \\nA subcaucus needed at least ${this.wholeViability.singularPlural(\"member\", \"members\")} to be viable.\\n`\n\n\t\t\tif (this.room > this.viableRoom) {\n\t\t\t\ttext += `${(this.room - this.viableRoom).singularPlural(\"person was\", \"people were\")} in a non-viable caucus, you may want to consider another round of walking.\\n`\n\t\t\t\ttext += `The recalculated viability number for allocating delegates was ${this.delegateViability.decimalPlaces(3)}.\\n`\n\t\t\t}\n\t\t\ttext += \"\\n\"\n\n\t\t} else {\n\t\t\ttext += \"Nobody was participating.\\n\\n\"\n\t\t}\n\n\n\t\tlet revised = new Date(Date.parse(this.revised))\n\n\t\ttext += `The coin had a random seed of ${this.seed}.\\n`\n\t\ttext += `Last revised ${revised.toLocaleString('en-US', { timeZoneName: 'short' })} \\n`\n\t\treturn text\n\t}\n\n}","/**\n * SubCalcStorage.ts\n * \n * Manages storage in app or localStorage.\n * Handles conversion to and from JSON.\n */\n\n// see https://github.com/ClickSimply/typescript-map\nimport { TSMap } from 'typescript-map'\n\n// see: https://github.com/mojotech/json-type-validation\nimport { Decoder, object, string, number, array } from '@mojotech/json-type-validation'\n\n// local to this app\nimport * as _u from './Utilities'\nimport { Snapshot } from './Snapshot'\n\ndeclare global {\n\n\t/**\n\t * JSON representation of subcalc2 in storage.\n\t */\n\tinterface SubCalcJSON {\n\t\tv: number\n\t\tdevice: number\n\t\tsnapshot: SnapshotJSON\n\t}\n\n}\n\n/**\n * Manages storage in app or localStorage.\n * Handles conversion to and from JSON.\n */\nexport class SubCalc {\n\n\tdebug = (): string => {\n\t\treturn this.snapshot.debug()\n\t}\n\n\t/**\n\t * Version helps to future-proof the stored JSON.\n\t */\n\tversion = 2\n\n\t/**\n\t * This device is just a random number that will help\n\t * distinguish meeting identifiers if they start to be\n\t * shared among devices. Hopefully a combination of \n\t * device and meeting creation date won't collide.\n\t */\n\tdevice: number\n\n\t/**\n\t * This is the snapshot that is currently being\n\t * edited. The unique creator and device combo \n\t * will make it part of a \"meeting\".\n\t * \n\t * This snapshot will always be its own unique object,\n\t * separate from the saved snapshots. The saved snapshots\n\t * are only used to \"load up\" this one. This is the only\n\t * one the App ever tries to change.\n\t */\n\tsnapshot: Snapshot\n\n\t/**\n\t * A prefix to be used when creating local storage items\n\t * for each snapshot.\n\t */\n\tstoredSnapshotPrefix = \"sc-save\"\n\n\t/**\n\t * A prefix for snapshots in local storage trash.\n\t */\n\ttrashedSnapshotPrefix = \"sc-trash\"\n\n\t/**\n\t * The json-type-validation decoder for this class.\n\t */\n\tstatic decoder: Decoder<SubCalcJSON> = object({\n\t\tv: number(),\n\t\tdevice: number(),\n\t\tsnapshot: Snapshot.decoder,\n\t})\n\n\t/**\n\t * Create an instance of a storage object to manage local storage.\n\t */\n\tconstructor() {\n\n\t\t// no device means that subcalc has never run in this browser\n\t\t// so we gather together some basics about this instance\n\n\t\tthis.device = _u.randomSeed()\n\n\t\t// a poorly formed snapshot to mark failure of the read\n\t\tthis.snapshot = new Snapshot({ device: 0, created: \"\" })\n\n\t\t// then we look for local data\n\t\t// if found, it will override the values above\n\n\t\tthis.read()\n\n\t\t// check to see if the read succeeded\n\t\tif (!this.snapshot.created) {\n\n\t\t\t// since no actual snapshot was assigned\n\t\t\t// we will get a real one now\n\n\t\t\tthis.snapshot = this.newSnapshot()\n\t\t}\n\n\t}\n\n\t/**\n\t * Returns a string to be used to retrive a snapshot from local storage.\n\t * \n\t * Returns the key for the current shapshot by default.\n\t */\n\tstoredSnapshotKey = (snapshot?: Snapshot) => {\n\t\tif (snapshot === undefined) {\n\t\t\tsnapshot = this.snapshot\n\t\t}\n\t\treturn `${this.storedSnapshotPrefix} ${snapshot.snapshotKey()}`\n\t}\n\n\t/**\n\t * Return an array of all the snapshots found in local storage.\n\t */\n\tsnapshots = (status: 'saved' | 'trashed' = 'saved'): Array<Snapshot> => {\n\t\tlet snapshots: Array<Snapshot> = []\n\n\t\tconst length = localStorage.length\n\t\tconst prefix = status === 'saved'\n\t\t\t? this.storedSnapshotPrefix\n\t\t\t: this.trashedSnapshotPrefix\n\n\t\tfor (let i = 0; i < length; i++) {\n\t\t\tconst storedKey = localStorage.key(i)\n\t\t\tif (!storedKey) break\n\t\t\tif (storedKey.startsWith(prefix)) {\n\t\t\t\tconst snapshot = this.readSnapshot(storedKey)\n\t\t\t\tif (snapshot) {\n\t\t\t\t\tsnapshots.push(snapshot)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn snapshots\n\t}\n\n\t/**\n\t * Ensures that not only is the current meeting set properly,\n\t * but that this change is reflected in local storage as well.\n\t * Returns the new copy of the snapshot now considered current.\n\t * \n\t * NOTE: This method recreates the snapshot as the current\n\t * snapshot so that all connections to the orginal are broken.\n\t */\n\tsetSnapshot = (snapshot: Snapshot): Snapshot => {\n\t\tthis.snapshot = snapshot.recreate()\n\t\tthis.write()\n\t\treturn this.snapshot\n\t}\n\n\t/**\n\t * Creates a new snapshot, amounting to a new meeting.\n\t */\n\tnewSnapshot = (): Snapshot => {\n\t\tconst created = _u.now()\n\n\t\t// first create a new snapshot and make it current\n\t\tconst snapshot = new Snapshot({\n\t\t\tdevice: this.device,\n\t\t\tcreated: created\n\t\t})\n\n\t\t// add three subcaucuses to give the user a clue\n\t\tsnapshot.addSubcaucus()\n\t\tsnapshot.addSubcaucus()\n\t\tsnapshot.addSubcaucus()\n\n\t\t// make this the current snapshot\n\t\tthis.setSnapshot(snapshot)\n\n\t\t// note, we return the copy of the snapshot we\n\t\t// want used, which is this.snapshot, not snapshot\n\t\treturn this.snapshot\n\t}\n\n\t/**\n\t * Creates a duplicate of the current snapshot, \n\t * giving it a new created date and new name,\n\t * amounting to a new meeting.\n\t * \n\t * Note, it will keep the same random seed (\"coin\")\n\t * as the original.\n\t */\n\tduplicateSnapshot = (): Snapshot => {\n\t\t// first create a new snapshot and make it current\n\t\tthis.snapshot.created = _u.now()\n\t\tthis.snapshot.name = `Copy of ${this.snapshot.name}`\n\t\tthis.snapshot.revised = this.snapshot.created\n\t\tthis.snapshot.revision = \"\"\n\n\t\t// make this the current snapshot\n\t\tthis.setSnapshot(this.snapshot)\n\n\t\t// note, we return the copy of the snapshot we\n\t\t// want used, which is this.snapshot, not snapshot\n\t\treturn this.snapshot\n\t}\n\n\t/**\n\t * Write the current subcalc2 item out to local storage.\n\t * \n\t * This includes writing the current snapshot out.\n\t */\n\twrite = () => {\n\t\tconst jsonSubCalc = {\n\t\t\tv: this.version,\n\t\t\tdevice: this.device,\n\t\t\tsnapshot: this.snapshot.toJSON()\n\t\t}\n\t\ttry {\n\t\t\tconst jsonSubCalcString = JSON.stringify(jsonSubCalc)\n\t\t\t_u.debug(\"storing subcalc2\", jsonSubCalcString)\n\t\t\tlocalStorage.setItem(\"subcalc2\", jsonSubCalcString)\n\t\t} catch (e) {\n\t\t\t_u.alertUser(new Error(\"Failed to save subcalc2 to local storage\"), e)\n\t\t}\n\t}\n\n\t/**\n\t * Write a single snapshot to local storage.\n\t * \n\t * Defaults to writing the current snapshot.\n\t */\n\twriteSnapshot = (snapshot?: Snapshot) => {\n\t\t// default to this.snapshot and if it is this.snapshot then write the subcalc2 record\n\t\tif (!snapshot) {\n\t\t\tsnapshot = this.snapshot\n\t\t}\n\t\tif (snapshot === this.snapshot) {\n\t\t\tthis.write()\n\t\t}\n\t\t// if the snapshot is a revision, then save it in its own place as well\n\t\tif (snapshot.revision) {\n\t\t\tconst storedSnapshotKey = this.storedSnapshotKey(snapshot)\n\t\t\tconst jsnap = snapshot.toJSON()\n\t\t\ttry {\n\t\t\t\tconst jsnapString = JSON.stringify(jsnap)\n\t\t\t\t_u.debug(`storing ${storedSnapshotKey}`, jsnapString)\n\t\t\t\tlocalStorage.setItem(storedSnapshotKey, jsnapString)\n\t\t\t} catch (e) {\n\t\t\t\t_u.alertUser(new Error(`Error saving ${storedSnapshotKey} to local storage`), e)\n\t\t\t\treturn\n\t\t\t}\n\t\t} else if (snapshot != this.snapshot) {\n\t\t\t_u.alertUser(new Error(\"Snapshot was not saved.\"), snapshot)\n\t\t}\n\t}\n\n\t/**\n\t * Pass along a revision to the snapshot,\n\t * then write the snapshot to local storage.\n\t */\n\treviseSnapshot = (update?: {\n\t\tname?: string,\n\t\tallowed?: number,\n\t\tseed?: number,\n\t}, snapshot?: Snapshot) => {\n\t\tif (!snapshot) {\n\t\t\tsnapshot = this.snapshot\n\t\t}\n\t\tsnapshot.revise(update)\n\t\tthis.writeSnapshot()\n\t}\n\n\tzeroSubcaucuses = () => {\n\t\tthis.snapshot.clearCounts()\n\t\tthis.writeSnapshot()\n\t}\n\n\t/**\n\t * Saves a snapshot with the given revision name.\n\t */\n\tsaveSnapshot = (revision: string) => {\n\t\tthis.snapshot.revision = revision\n\t\tthis.writeSnapshot()\n\t}\n\n\t/**\n\t * Uses the current snapshot to rename the meeting by propagating\n\t * that change to all the other snapshots in the meeting.\n\t */\n\trenameMeeting = (name: string) => {\n\t\t// rename the current snapshot\n\t\tthis.snapshot.name = name\n\t\tthis.write()\n\t\tconst meetingKey = this.snapshot.meetingKey()\n\t\tthis.snapshots().forEach((snapshot) => {\n\t\t\tif (snapshot.meetingKey() === meetingKey) {\n\t\t\t\tsnapshot.name = name\n\t\t\t\tthis.writeSnapshot(snapshot)\n\t\t\t}\n\t\t})\n\t}\n\n\t/**\n\t * Remove a snapshot from local storage. If this is the last\n\t * snapshot in a meeting, this will also remove the meeting.\n\t * \n\t * NOTE: This method will not remove the \"current\" snapshot.\n\t */\n\ttrashSnapshot = (snapshot: Snapshot) => {\n\t\tconst snapshotKey = snapshot.snapshotKey()\n\t\tconst keyContent = localStorage.getItem(`${this.storedSnapshotPrefix} ${snapshotKey}`)\n\t\tif (keyContent) {\n\t\t\tlocalStorage.removeItem(`${this.storedSnapshotPrefix} ${snapshotKey}`)\n\t\t\tlocalStorage.setItem(`${this.trashedSnapshotPrefix} ${snapshotKey}`, keyContent)\n\t\t} else {\n\t\t\t_u.alertUser(new Error(`Could not find ${this.storedSnapshotPrefix} ${snapshotKey}`))\n\t\t}\n\t}\n\n\t/**\n\t * Delete all the trashed snapshots from local storage.\n\t */\n\temptyTrash = () => {\n\t\tthis.snapshots(\"trashed\").forEach((snapshot) => {\n\t\t\tconst snapshotKey = snapshot.snapshotKey()\n\t\t\tlocalStorage.removeItem(`${this.trashedSnapshotPrefix} ${snapshotKey}`)\n\t\t})\n\t}\n\n\n\t/**\n\t * Try to populate this instance with subcalc2 data from local storage.\n\t */\n\tread = () => {\n\t\tlet json: SubCalcJSON\n\n\t\ttry {\n\t\t\tjson = JSON.parse(localStorage.getItem(\"subcalc2\") || 'false')\n\t\t} catch (e) {\n\t\t\t_u.debug(e)\n\t\t\treturn\n\t\t}\n\n\t\tif (json) {\n\n\t\t\tlet decoded = SubCalc.decoder.run(json)\n\n\t\t\tif (decoded.ok) {\n\t\t\t\tif (this.version !== decoded.result.v) {\n\t\t\t\t\t_u.debug(`Expected subcalc version ${this.version}, got ${decoded.result.v}`)\n\t\t\t\t}\n\t\t\t\tthis.device = decoded.result.device\n\t\t\t\tthis.snapshot = new Snapshot({\n\t\t\t\t\tdevice: decoded.result.snapshot.device,\n\t\t\t\t\tcreated: decoded.result.snapshot.created,\n\t\t\t\t\tjson: decoded.result.snapshot\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\t_u.debug(decoded.error)\n\t\t\t}\n\n\t\t} else {\n\t\t\t// TODO: check for old subcalc1 data\n\t\t}\n\t}\n\n\t/**\n\t * Given a snapshot key, this functions looks for that meeting in\n\t * local storage and returns a new meeting object to holding that information.\n\t */\n\treadSnapshot = (storedSnapshotKey: string): Snapshot | undefined => {\n\t\tlet json: SnapshotJSON\n\n\t\ttry {\n\t\t\tjson = JSON.parse(localStorage.getItem(storedSnapshotKey) || 'false')\n\t\t} catch (e) {\n\t\t\t_u.debug(e)\n\t\t\treturn undefined\n\t\t}\n\n\t\tconst decoded = Snapshot.decoder.run(json)\n\n\t\tif (decoded.ok) {\n\t\t\treturn new Snapshot({\n\t\t\t\tcreated: decoded.result.created,\n\t\t\t\tdevice: decoded.result.device,\n\t\t\t\tjson: decoded.result\n\t\t\t})\n\t\t} else {\n\t\t\t_u.debug(decoded.error)\n\t\t}\n\n\t\treturn undefined\n\n\t}\n\n}","import * as React from 'react'\n// see https://github.com/ClickSimply/typescript-map\nimport { TSMap } from 'typescript-map'\n// see https://www.primefaces.org/primereact\nimport { Button } from 'primereact/button'\nimport { Menubar } from 'primereact/menubar'\nimport { Accordion, AccordionTab } from 'primereact/accordion';\n// local to this app\nimport * as _u from './Utilities'\nimport { SubCalc } from './SubCalc'\nimport { Snapshot } from './Snapshot'\nimport { ValueCard } from './ValueCard'\n\n/**\n * Facilitates sorting up or down (or not at all), as needed.\n */\nenum SortOrder {\n    Descending = -1,\n    None = 0,\n    Ascending = 1,\n}\n\ninterface Props {\n    subcalc: SubCalc\n    onLoad: ((snapshot?: Snapshot) => void)\n    onNew: (() => void)\n}\ninterface State {\n    sortBy: 'name' | 'date'\n    showing: 'saved' | 'trashed'\n}\n\nexport class Loader extends React.Component<Props, State> {\n\n    constructor(props: Props) {\n        super(props)\n        this.state = {\n            sortBy: \"date\",\n            showing: \"saved\"\n        }\n    }\n\n    /**\n     * Returns JSX for the menubar.\n     * \n     * NOTE: Do not `setState()` in this method.\n     */\n    renderMenu = (): JSX.Element => {\n        const items: any = []\n        items.push({\n            label: \"Back to the calculator\",\n            icon: \"pi pi-fw pi-caret-left\",\n            command: () => this.props.onLoad()\n        })\n        return <Menubar key=\"loader-menu\" model={items} id=\"app-main-menu\" />\n    }\n\n    /**\n     * Returns an icon to represent the button.\n     */\n    sortOrderIcon = (button: 'name' | 'date'): string => {\n        return button === 'name'\n            ? this.state.sortBy === \"name\"\n                ? \"pi pi-chevron-circle-up\"\n                : \"pi pi-chevron-circle-off\"\n            : this.state.sortBy === \"date\"\n                ? \"pi pi-chevron-circle-down\"\n                : \"pi pi-chevron-circle-off\"\n    }\n\n    toggleSortOrder = () => {\n        this.setState({\n            sortBy: this.state.sortBy === \"name\"\n                ? \"date\"\n                : \"name\"\n        })\n    }\n\n    deleteSnapshot = (snapshot: Snapshot) => {\n        this.props.subcalc.trashSnapshot(snapshot)\n        this.forceUpdate()\n    }\n\n    renderSnapshot = (snapshot: Snapshot): JSX.Element => {\n        const created = new Date(Date.parse(snapshot.created))\n        const createdDate = created.toLocaleString(undefined, {\n            year: 'numeric',\n            month: 'numeric',\n            day: 'numeric',\n        })\n        const revised = new Date(Date.parse(snapshot.revised))\n        const revisedDate = revised.toLocaleString(undefined, {\n            year: 'numeric',\n            month: 'numeric',\n            day: 'numeric',\n        })\n        const revisedString = createdDate === revisedDate\n            ? revised.toLocaleString(undefined, {\n                hour: 'numeric',\n                minute: '2-digit',\n                second: undefined,\n            })\n            : revised.toLocaleString(undefined, {\n                year: 'numeric',\n                month: 'numeric',\n                day: 'numeric',\n                hour: 'numeric',\n                minute: '2-digit',\n                second: undefined,\n            })\n\n        return (\n            <div key={`loader-snapshot-${snapshot.revised}-${snapshot.device}`} className={`loader-snapshot`}>\n                <div className=\"loader-snapshot-button button\"\n                    onClick={() => this.props.onLoad(snapshot)}\n                >\n                    <div className=\"loader-snapshot-revised\">\n                        {revisedString}\n                    </div>\n                    <div className=\"loader-snapshot-name\">\n                        <span className={\"pi pi-clock\"}>&nbsp;</span>\n                        {snapshot.revision}\n                    </div>\n                </div>\n                {this.state.showing === \"saved\"\n                    ? <div className=\"loader-snapshot-actions\">\n                        <Button\n                            icon=\"pi pi-trash\"\n                            className=\"p-button-danger\"\n                            onClick={() => this.deleteSnapshot(snapshot)}\n                        />\n\n                    </div>\n                    : ''\n                }\n            </div>\n        )\n    }\n\n    renderSnapshots = (snapshots: TSMap<string, Snapshot>): JSX.Element => {\n        return (\n            <>\n                {snapshots.map((snapshot) => {\n                    return this.renderSnapshot(snapshot)\n                })}\n            </>\n        )\n    }\n\n    /**\n     * A method to sort snapshots by date.\n     */\n    sortBySnapshotRevision = (a: Snapshot, b: Snapshot): number => {\n        let comparison = 0\n        const revA = `${a.created} ${a.device} ${a.revised}`\n        const revB = `${b.created} ${b.device} ${b.revised}`\n        if (revA < revB) {\n            comparison = 1;\n        }\n        if (revA > revB) {\n            comparison = -1;\n        }\n        return comparison\n    }\n\n    /**\n     * A method to sort snapshots by name.\n     */\n    sortBySnapshotName = (a: Snapshot, b: Snapshot): number => {\n        let comparison = 0\n        const revA = `${a.name} ${a.created} ${a.device} ${a.revision}`.toUpperCase()\n        const revB = `${b.name} ${b.created} ${b.device} ${b.revision}`.toUpperCase()\n        if (revA < revB) {\n            comparison = -1;\n        }\n        if (revA > revB) {\n            comparison = 1;\n        }\n        return comparison\n    }\n\n    renderMeeting = (snapshots: Array<Snapshot>): JSX.Element => {\n        const snap = snapshots[0]\n        const snapshotsJSX = snapshots.map((snapshot) => this.renderSnapshot(snapshot))\n\n        const created = new Date(Date.parse(snap.created))\n        const createdDate = created.toLocaleString(undefined, {\n            year: 'numeric',\n            month: 'numeric',\n            day: 'numeric',\n            hour: 'numeric',\n            minute: '2-digit',\n            second: undefined,\n        })\n\n        return (\n            <AccordionTab key={`loader-meeting-${snap.meetingKey()} ${this.state.sortBy} ${this.state.showing}`}\n                headerClassName={`loader-meeting-accordion-header ${this.state.showing}`}\n                contentClassName=\"loader-meeting-accordion-content\"\n                header={\n                    <div className={`loader-meeting-header`}>\n                        <div className=\"loader-meeting-name\">{snap.name}</div>\n                        <div className=\"loader-meeting-timestamp\">{createdDate}</div>\n                    </div>\n                }\n            >\n                {snapshotsJSX}\n            </AccordionTab>\n        )\n\n    }\n\n    renderMeetings = (): JSX.Element => {\n        const snapshots = this.props.subcalc.snapshots(this.state.showing)\n\n        if (snapshots.length === 0) {\n            return this.state.showing === \"saved\"\n                ? <ValueCard key=\"nothing-to-load\"\n                    title=\"No snapshots yet\"\n                    description=\"You will have to save a snapshot before you can open one!\"\n                    footer={\n                        <Button key=\"nothing-to-load-button\"\n                            label=\"OK\"\n                            icon=\"pi pi-check\"\n                            onClick={() => this.props.onLoad()}\n                        />\n                    }\n                />\n                : <ValueCard key=\"nothing-to-load\"\n                    title=\"Nothing in the trash\"\n                    description=\"The trash is empty.\"\n                    footer={\n                        <Button key=\"nothing-to-load-button\"\n                            label=\"OK\"\n                            icon=\"pi pi-check\"\n                            onClick={() => this.setState({ showing: \"saved\" })}\n                        />\n                    }\n                />\n        }\n\n        const currentMeetingKey = this.props.subcalc.snapshot.meetingKey()\n\n        // loop thought the snapshots, sorting them and splitting them\n        // into meetings and creating a JSX array to return\n        let tabs: Array<JSX.Element> = []\n        let meetingKey = \"\"\n        let meetingIndex = 0\n        let indexOfCurrent = 0\n        let meetingSnapshots: Array<Snapshot> = []\n        const sort = this.state.sortBy === \"name\"\n            ? this.sortBySnapshotName\n            : this.sortBySnapshotRevision\n\n        snapshots.sort(sort).forEach((snapshot) => {\n            if (meetingKey !== snapshot.meetingKey()) {\n                meetingKey = snapshot.meetingKey()\n                if (meetingKey === currentMeetingKey) {\n                    indexOfCurrent = meetingIndex\n                }\n                meetingIndex++\n                if (meetingSnapshots.length > 0) {\n                    tabs.push(this.renderMeeting(meetingSnapshots))\n                }\n                meetingSnapshots = []\n            }\n            meetingSnapshots.push(snapshot)\n        })\n\n        tabs.push(this.renderMeeting(meetingSnapshots))\n\n        return (\n            <div key={`loader-meetings`} className=\"loader-meetings\">\n                <Accordion key={`${this.state.sortBy}`}\n                    activeIndex={indexOfCurrent}\n                >\n                    {tabs}\n                </Accordion>\n            </div>\n        )\n    }\n\n    render() {\n        return (\n            <div className=\"loader\">\n                {this.renderMenu()}\n                <div id=\"meeting-info\">\n                    <div id=\"meeting-name\" className=\"not-button\">\n                        Pick a snapshot below to open it...\n                    </div>\n                </div>\n                <div id=\"loader-container\">\n                    <div id=\"loader-header\">\n                        <Button id=\"loader-name-head\"\n                            label=\"Name\"\n                            icon={this.sortOrderIcon(\"name\")}\n                            onClick={() => this.toggleSortOrder()}\n                        />\n                        <Button id=\"loader-timestamp-head\"\n                            label=\"Last Revised\"\n                            iconPos=\"right\"\n                            icon={this.sortOrderIcon(\"date\")}\n                            onClick={() => this.toggleSortOrder()}\n                        />\n                    </div>\n                    {this.renderMeetings()}\n                    <div id=\"subcaucus-footer\">\n                        {this.state.showing === 'saved'\n                            ? <Button id=\"add-meeting-button\"\n                                label=\"Add new meeting\"\n                                icon=\"pi pi-calendar-plus\"\n                                onClick={() => this.props.onNew()}\n                            />\n                            : <Button id=\"empty-trash-button\"\n                                label=\"Empty trash\"\n                                icon=\"pi pi-trash\"\n                                onClick={() => {\n                                    this.props.subcalc.emptyTrash()\n                                    this.setState({ showing: \"saved\" })\n                                }}\n                            />\n                        }\n                        {this.state.showing === 'saved'\n                            ? <Button id=\"show-trashed-button\"\n                                label=\"Show trash\"\n                                icon=\"pi pi-trash\"\n                                className=\"p-button-secondary\"\n                                onClick={() => this.setState({ showing: \"trashed\" })}\n                            />\n                            : <Button id=\"show-saved-button\"\n                                label=\"Show saved\"\n                                icon=\"pi pi-calendar\"\n                                className=\"p-button-secondary\"\n                                onClick={() => this.setState({ showing: \"saved\" })}\n                            />\n                        }\n                        <Button id=\"cancel-loader-button\"\n                            label=\"Cancel\"\n                            icon=\"pi pi-times\"\n                            className=\"p-button-secondary\"\n                            onClick={() => this.props.onLoad()}\n                        />\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n","import * as React from 'react'\n// see https://www.primefaces.org/primereact\nimport { Button } from 'primereact/button'\nimport { Card } from 'primereact/card'\nimport { InputText } from 'primereact/inputtext'\n// local to this app\nimport * as _u from './Utilities'\n\ntype KindOfValue = 'text' | 'positive integer'\n\ninterface Props {\n    id?: string\n    title: string\n    description?: string\n    image?: string\n    alt?: string\n    extraButtons?: JSX.Element\n    footer?: JSX.Element\n    type?: KindOfValue\n    value?: string\n    defaultValue?: string\n    allowEmpty?: boolean\n    onSave?: ((value?: string) => void)\n}\ninterface State {\n    value: string\n}\n\nexport class ValueCard extends React.Component<Props, State> {\n\n    isPositiveInteger = false\n\n    constructor(props: Props) {\n        super(props)\n        this.isPositiveInteger = this.props.type === 'positive integer'\n        let initialValue = _u.unwrapString(this.props.value)\n        if (!this.props.allowEmpty && this.isEmpty(initialValue)) {\n            initialValue = _u.unwrapString(this.props.defaultValue)\n        }\n        this.state = {\n            value: initialValue,\n        }\n    }\n\n    originalValue = (): string => {\n        return _u.unwrapString(this.props.value)\n    }\n\n    defaultValue = (): string => {\n        return _u.unwrapString(this.props.defaultValue)\n    }\n\n    handleChange = () => (event: React.FormEvent<HTMLInputElement>) => {\n        _u.debug(\"change\", event.currentTarget.value)\n        if (this.isPositiveInteger) {\n            var num = Number(event.currentTarget.value)\n            if (num < 0) {\n                num = 0\n            }\n            this.setState({ value: String(num) })\n        } else {\n            this.setState({ value: event.currentTarget.value })\n        }\n    }\n\n    handleKey = () => (event: React.KeyboardEvent<HTMLInputElement>) => {\n        if (event.key === 'Enter') {\n            if (this.props.onSave) {\n                this.props.onSave(this.state.value.trim())\n            }\n        }\n    }\n\n    focusOnWholeText = () => (event: React.FormEvent<HTMLInputElement>) => {\n        // event properties must be copied to use async\n        const target = event.currentTarget\n        // do this async to try to make Safari behave\n        setTimeout(() => target.setSelectionRange(0, 9999), 0)\n    }\n\n    isEmpty = (value?: string): boolean => {\n        var empty = (value === '') || (value === undefined)\n        if (this.isPositiveInteger) {\n            empty = (empty || value === '0')\n        }\n        return empty\n    }\n\n    save = (value?: string) => (event: React.MouseEvent<HTMLButtonElement>) => {\n        if (this.props.onSave) {\n            if (value === undefined) {\n                this.props.onSave()\n            } else if (this.isEmpty(value) && !this.props.allowEmpty) {\n                if (!this.isEmpty(this.props.defaultValue)) {\n                    this.props.onSave(this.props.defaultValue)\n                }\n            } else {\n                this.props.onSave(value.trim())\n            }\n        }\n    }\n\n    idPlus = (suffix: string): string | undefined => {\n        return this.props.id ? `${this.props.id}-${suffix}` : undefined\n    }\n\n    render() {\n\n        const { value } = this.state\n        const isPositiveInteger = this.isPositiveInteger\n\n        let cardFooter = <></>\n\n        if (this.props.footer == undefined) {\n            const illegallyEmpty = (this.isEmpty(value) && this.isEmpty(this.defaultValue()) && this.props.allowEmpty === false)\n            const originalIllegallyEmpty = (this.isEmpty(this.originalValue()) && this.props.allowEmpty === false)\n\n            // don't show a save button at all if there is no save function\n            // and if there is no value property, then call the save button \"close\" instead\n            const saveButton = (this.props.onSave\n                ? ((this.props.value != undefined)\n                    ? <Button id={this.idPlus(\"save-button\")}\n                        label=\"Save\"\n                        icon=\"pi pi-check\"\n                        disabled={illegallyEmpty}\n                        onClick={this.save(_u.unwrapString(value, this.defaultValue()))}\n                    />\n                    : <Button id={this.idPlus(\"close-button\")}\n                        label=\"Close\"\n                        icon=\"pi pi-times\"\n                        onClick={this.save()}\n                    />\n                )\n                : <></>\n            )\n\n            const cancelButton = originalIllegallyEmpty || this.props.value === undefined\n                ? ''\n                : <Button id={this.idPlus(\"cancel-button\")}\n                    label=\"Cancel\"\n                    icon=\"pi pi-times\"\n                    className=\"p-button-secondary\"\n                    onClick={this.save()}\n                />\n\n            cardFooter = <>{saveButton}{this.props.extraButtons}{cancelButton}</>\n        } else {\n            cardFooter = this.props.footer\n        }\n\n        return (\n            <div className=\"valuecard-wrapper\">\n                <div className=\"background-blocker\">\n                </div>\n                <Card id={this.idPlus(\"valuecard\")}\n                    className={`valuecard ${this.idPlus(\"valuecard\")}`}\n                    title={this.props.title}\n                    header={this.props.image\n                        ? <div id={this.idPlus(\"picture-container\")}\n                            className=\"picture-container\"\n                        >\n                            <img\n                                alt={`${this.props.alt}`}\n                                src={`${this.props.image}`}\n                            />\n                            {this.props.onSave\n                                ? <></>\n                                : <Button\n                                    id={this.idPlus(\"picture-close-button\")}\n                                    icon=\"pi pi-times\"\n                                    onClick={this.save()}\n                                />\n                            }\n                        </div>\n                        : undefined\n                    }\n                    footer={cardFooter}\n                >\n                    {this.props.children\n                        ? <div id={this.idPlus(\"valuecard-children\")} className=\"valuecard-children\">\n                            {this.props.children}\n                        </div>\n                        : ''}\n                    {this.props.description\n                        ? <div id={this.idPlus(\"valuecard-description\")} className=\"valuecard-description\">\n                            <p>{this.props.description}</p>\n                        </div>\n                        : ''}\n                    {this.props.value != undefined\n                        ? <InputText id={this.idPlus(\"card-field\")}\n                            className={isPositiveInteger ? \"number\" : \"text\"}\n                            autoComplete=\"off\"\n                            keyfilter={isPositiveInteger ? \"pint\" : \"\"}\n                            type=\"text\"\n                            pattern={isPositiveInteger ? \"\\\\d*\" : undefined}\n                            value={isPositiveInteger ? (value === '0' ? '' : value) : value} // show 0 as blank for positive integers\n                            placeholder={this.props.defaultValue}\n                            onChange={this.handleChange()}\n                            // onFocus={this.isPositiveInt ? this.focusOnWholeText() : undefined}\n                            onKeyUp={this.handleKey()}\n                            autoFocus\n                        />\n                        : ''\n                    }\n                </Card>\n            </div>\n        )\n    }\n}\n","import * as React from 'react'\n\n// see https://www.primefaces.org/primereact\nimport { Button } from 'primereact/button'\n\n// local to this app\nimport * as _u from './Utilities'\nimport { Subcaucus } from './Subcaucus'\nimport { ValueCard } from './ValueCard'\n\ninterface Props {\n\tsubcaucus: Subcaucus\n\tdismiss: (() => void)\n}\n\ninterface State { }\n\n/**\n * Component to show a subcaucus row info cards.\n */\nexport class SubcaucusRowInfoCard extends React.Component<Props, State> {\n\n\tconstructor(props: Props) {\n\t\tsuper(props)\n\t\tthis.state = {}\n\t}\n\n\trender() {\n\t\t_u.debug(\"render info card\", this.props.subcaucus.id)\n\n\t\tconst { subcaucus: s, dismiss } = this.props\n\n\t\treturn (\n\t\t\t<ValueCard\n\t\t\t\ttitle={s.displayName()}\n\t\t\t\tfooter={\n\t\t\t\t\t<Button\n\t\t\t\t\t\tlabel=\"OK\"\n\t\t\t\t\t\tonClick={dismiss}\n\t\t\t\t\t/>\n\t\t\t\t}\n\t\t\t>\n\t\t\t\t{s.delegates\n\t\t\t\t\t? <p>The <strong>{s.count.singularPlural(\"member\", \"members\")}</strong> of this subcaucus may elect <strong>{s.delegates.singularPlural(\"delegate\", \"delegates\")}</strong>.</p>\n\t\t\t\t\t: <p>This subcaucus did not attract enough members to be viable. It may not elect any delegates. Members of this subcaucus should consider joining other subcaucuses in order to have some say in the delegates elected.</p>\n\t\t\t\t}\n\t\t\t\t<p>{s.remainder === 0 ? '' : <span>This subcaucus had a remainder of <strong>{s.remainder.decimalPlaces(3)}</strong>. </span>}\n\t\t\t\t\t{s.delegates > s.baseDelegates ? <span>It was awarded a <strong>remainder delegate</strong> because it had one of the higher remainders. </span> : ''}\n\t\t\t\t\t{s.tosses().map((toss) => {\n\t\t\t\t\t\treturn <span>It {toss.won ? \"won\" : \"lost\"} a coin toss against {toss.against.displayName()}. </span>\n\t\t\t\t\t})}\n\t\t\t\t</p>\n\t\t\t</ValueCard>\n\t\t)\n\t}\n}\n","import * as React from 'react'\n// see https://www.primefaces.org/primereact\nimport { Button } from 'primereact/button'\nimport { InputText } from 'primereact/inputtext'\nimport { InputTextarea } from 'primereact/inputtextarea'\n// local to this app\nimport * as _u from './Utilities'\nimport { Subcaucus } from './Subcaucus'\nimport { SubcaucusRowInfoCard } from './SubcaucusRowInfoCard'\n\nexport type SubcaucusRowAction = 'recalc' | 'enter'\n\ninterface Props {\n\tsubcaucus: Subcaucus\n\tindex: number\n\trows: number\n\texchange: ((subcaucus: Subcaucus, action: SubcaucusRowAction, index?: number, callback?: () => void) => void)\n}\n\ninterface State {\n\tname: string\n\tcount: number\n\tdelegates: number\n\tshowInfo: boolean\n}\n\n/**\n * Component to show a single subcaucus row.\n * Also controls subcaucus row info cards.\n */\nexport class SubcaucusRow extends React.Component<Props, State> {\n\n\tconstructor(props: Props) {\n\t\tsuper(props)\n\t\tthis.state = {\n\t\t\tname: this.props.subcaucus.name,\n\t\t\tcount: this.props.subcaucus.count,\n\t\t\tdelegates: this.props.subcaucus.delegates,\n\t\t\tshowInfo: false\n\t\t}\n\t}\n\n\thandleName = () => (event: React.FormEvent<HTMLTextAreaElement>) => {\n\t\tconst currentTabIndex = event.currentTarget.tabIndex\n\t\tvar value = event.currentTarget.value\n\t\t_u.debug(\"handle name index\", currentTabIndex, \"is\", value)\n\t\tthis.setState({ name: value })\n\t}\n\n\thandleCount = () => (event: React.FormEvent<HTMLInputElement>) => {\n\t\tconst currentTabIndex = event.currentTarget.tabIndex\n\t\tvar num = Number(event.currentTarget.value)\n\t\t_u.debug(\"handle count index\", currentTabIndex, \"is\", num)\n\t\tif (num < 0) {\n\t\t\tnum = 0\n\t\t}\n\t\tthis.setState({ count: num })\n\t}\n\n\thandleBlur = () => (event: React.FormEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n\t\tconst { subcaucus } = this.props\n\t\tconst currentTabIndex = event.currentTarget.tabIndex\n\t\t_u.debug(\"handle blur index\", currentTabIndex)\n\t\tif (subcaucus.name !== this.state.name || subcaucus.count !== this.state.count) {\n\t\t\tsubcaucus.name = this.state.name\n\t\t\tsubcaucus.count = this.state.count\n\t\t\tthis.props.exchange(subcaucus, 'recalc')\n\t\t}\n\t}\n\n\thandleKey = () => (event: React.KeyboardEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n\t\tconst { rows, subcaucus } = this.props\n\t\tconst currentTabIndex = event.currentTarget.tabIndex\n\t\t_u.debug(\"handle key index\", currentTabIndex, \"got\", event.key, \"for\", subcaucus.id, subcaucus.debug())\n\t\tif (event.key === 'Enter' || event.key === 'Tab') {\n\t\t\tevent.preventDefault()\n\t\t\tsubcaucus.name = this.state.name\n\t\t\tsubcaucus.count = this.state.count\n\t\t\t// enters will not normally select the next row\n\t\t\t// so we have to force it with a callback that happens after the add subcaucus\n\t\t\tthis.props.exchange(subcaucus, 'enter', currentTabIndex, () => {\n\t\t\t\t// if we are in the last position of the count column,\n\t\t\t\t// then the next position after adding a subcaucus will be 2 ahead\n\t\t\t\tconst next = currentTabIndex == rows * 2 ? 2 : 1\n\t\t\t\t// walk through all the subcaucus fields looking for the next one\n\t\t\t\tdocument.querySelectorAll(\".subcaucus-field\").forEach((e) => {\n\t\t\t\t\tconst element = e as HTMLElement\n\t\t\t\t\tif (element.tabIndex === currentTabIndex + next) {\n\t\t\t\t\t\t// then force the focus to this field\n\t\t\t\t\t\telement.focus()\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t})\n\t\t}\n\t}\n\n\tfocusOnWholeText = () => (event: React.FormEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n\t\t// event properties must be copied to use async\n\t\tconst target = event.currentTarget\n\t\t// do this async to try to make Safari behave\n\t\tsetTimeout(() => target.setSelectionRange(0, 9999), 0)\n\t}\n\n\tidPlus = (suffix: string): string | undefined => {\n\t\treturn `subcaucus-${this.props.subcaucus.id}-${suffix}`\n\t}\n\n\trender() {\n\t\tconst { subcaucus: s } = this.props\n\n\t\t_u.debug(\"render row\", s.id, this.state)\n\n\t\tconst { name, count, showInfo } = this.state\n\n\t\tconst infoCard = showInfo\n\t\t\t? <SubcaucusRowInfoCard\n\t\t\t\tsubcaucus={s}\n\t\t\t\tdismiss={() => this.setState({ showInfo: false })}\n\t\t\t/>\n\t\t\t: ''\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<div id={this.idPlus(\"row\")}\n\t\t\t\t\tclassName={`subcaucus-row ${s.delegates > 0 ? \"has-delegates\" : (count > 0 ? \"no-delegates\" : \"\")}`}\n\t\t\t\t>\n\t\t\t\t\t{_u.isDebugging ? <div className=\"subcaucus-id\">{s.id}</div> : ''}\n\t\t\t\t\t<InputTextarea id={this.idPlus(\"row-name\")}\n\t\t\t\t\t\tclassName=\"subcaucus-field subcaucus-name\"\n\t\t\t\t\t\tautoComplete=\"off\"\n\t\t\t\t\t\ttabIndex={this.props.index}\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tvalue={name}\n\t\t\t\t\t\trows={1}\n\t\t\t\t\t\tcols={1}\n\t\t\t\t\t\t// PrimeReact has a bug with the InputTextarea placeholder\n\t\t\t\t\t\t// for now, it will not update this placeholder\n\t\t\t\t\t\t// see: https://github.com/primefaces/primereact/issues/747\n\t\t\t\t\t\tplaceholder={s.defaultName()}\n\t\t\t\t\t\tonChange={this.handleName()}\n\t\t\t\t\t\tonKeyDown={this.handleKey()}\n\t\t\t\t\t\tonBlur={this.handleBlur()}\n\t\t\t\t\t\tonFocus={this.focusOnWholeText()}\n\t\t\t\t\t/>\n\t\t\t\t\t<InputText id={this.idPlus(\"row-count\")}\n\t\t\t\t\t\tclassName=\"subcaucus-field subcaucus-count\"\n\t\t\t\t\t\tautoComplete=\"off\"\n\t\t\t\t\t\ttabIndex={this.props.index + this.props.rows}\n\t\t\t\t\t\tkeyfilter=\"pint\"\n\t\t\t\t\t\ttype=\"text\" // number does not support selection of the whole text on\n\t\t\t\t\t\tpattern=\"\\d*\"\n\t\t\t\t\t\tvalue={count ? count : ''}\n\t\t\t\t\t\tplaceholder={``}\n\t\t\t\t\t\tonChange={this.handleCount()}\n\t\t\t\t\t\tonKeyDown={this.handleKey()}\n\t\t\t\t\t\tonBlur={this.handleBlur()}\n\t\t\t\t\t\t// forcing the selction of the whole text seems to lead to problems\n\t\t\t\t\t\t// see https://grand.clst.org:3000/tenseg/subcalc-pr/issues/3\n\t\t\t\t\t\tonFocus={this.focusOnWholeText()}\n\t\t\t\t\t/>\n\t\t\t\t\t<Button id={this.idPlus(\"row-delegates\")}\n\t\t\t\t\t\tclassName={`subcaucus-delegates-button ${s.delegates > 0 ? \"p-button-success\" : \"p-button-secondary\"}`}\n\t\t\t\t\t\tlabel={s.delegates ? `${s.delegates}` : undefined}\n\t\t\t\t\t\ticon={s.delegates ? undefined : (count ? 'pi pi-ban' : 'pi')}\n\t\t\t\t\t\tonClick={() => this.setState({ showInfo: true })}\n\t\t\t\t\t\tdisabled={count === 0}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div className={\n\t\t\t\t\t\t\ts.reportTosses\n\t\t\t\t\t\t\t\t? s.delegates > s.baseDelegates\n\t\t\t\t\t\t\t\t\t? \"coin won\"\n\t\t\t\t\t\t\t\t\t: \"coin lost\"\n\t\t\t\t\t\t\t\t: \"coin\"\n\t\t\t\t\t\t}></div>\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t\t{infoCard}\n\t\t\t</>\n\t\t)\n\t}\n}\n","import * as React from 'react'\n\n// see https://www.primefaces.org/primereact\nimport { Button } from 'primereact/button'\nimport { Menubar } from 'primereact/menubar'\nimport { Growl } from 'primereact/growl'\nimport 'primereact/resources/primereact.min.css'\nimport 'primereact/resources/themes/nova-light/theme.css'\nimport 'primeicons/primeicons.css'\n\n// local to this app\nimport './App.scss'\nimport * as _u from './Utilities'\nimport { SubCalc } from './SubCalc'\nimport { Snapshot } from './Snapshot'\nimport { Subcaucus } from './Subcaucus'\nimport { SubcaucusRow, SubcaucusRowAction } from './SubcaucusRow'\nimport { ValueCard } from './ValueCard'\nimport { Loader } from './Loader'\nimport { ShowJSON } from './ShowJSON'\n\n/**\n * Facilitates sorting up or down (or not at all), as needed.\n */\nenum SortOrder {\n    Descending = -1,\n    None = 0,\n    Ascending = 1,\n}\n\n/**\n * Includes the modal cards we can display.\n * When more than one card is waiting to be viewed,\n * they will be presented in the order listed in\n * this enumerator.\n * \n * NOTE: If you add a value you must also add a case\n * to the `renderNextCard()` method for the card to\n * ever be seen.\n */\nenum CardFor {\n    WelcomeAndSetName,\n    ChangingName,\n    ChangingDelegates,\n    ChangingCoin,\n    SavingSnapshot,\n    SavingSnapshotBefore,\n    RemovingEmpties,\n    ShowingAbout,\n    ShowingBy,\n    ShowingInstructions,\n    ShowingSecurity,\n}\n\nenum Presenting {\n    Calculator,\n    Loading,\n}\n\n/**\n * Details that our calculations need to share out\n * to the user.\n */\ninterface SummaryInfo {\n    count: number\n    delegates: number\n    viability: number\n    revisedViability: number\n    minimumCountForViability: number\n    nonViableCount: number\n}\n\ninterface Props { }\n\n/**\n * React state for the SubCalc App.\n */\ninterface State {\n    // modal interactions\n    cards: Array<CardFor>\n    afterBefore?: () => void\n    present: Presenting\n    // sorting info\n    sortName: SortOrder\n    sortCount: SortOrder\n}\n\nexport class App extends React.Component<Props, State> {\n\n    /**\n     * An instance of `SubCalc` that we use to\n     * read and write data from and to local storage.\n     */\n    private subcalc = new SubCalc()\n\n    /**\n     * To be included with component key whenever you want\n     * to be sure that component will _not_ be reused\n     * when the App refreshes with a new snapshot.\n     */\n    private keySuffix = String(Math.random())\n\n    /**\n     * This set of cards is to be presented whenever\n     * the user loads a new meeting. It forces them to\n     * create a meeting name and disclose the number of\n     * delegates to be allowed from this meeting.\n     */\n    initialCardState: Array<CardFor> = [\n        CardFor.WelcomeAndSetName,\n        CardFor.ChangingDelegates,\n        // CardFor.ShowingInstructions\n    ]\n\n    /**\n     * A reference to the  PrimeReact growl notifier \n     * used to share alerts with the user. This reference\n     * is set during the `render()` stage.\n     */\n    growl: Growl | null = null\n\n    /**\n     * Creates the new SubCalc App.\n     */\n    constructor(props: Props) {\n        super(props)\n\n        _u.setAlertFunction(this.growlAlert)\n\n        this.subcalc.snapshot.redistributeDelegates()\n\n        this.state = {\n            // card status\n            cards: this.subcalc.snapshot.allowed ? [] : this.initialCardState,\n            present: Presenting.Calculator,\n            // sorting info\n            sortName: SortOrder.None,\n            sortCount: SortOrder.None,\n        }\n    }\n\n    /**\n     * Either load the snapshot or return to the calculator.\n     * This is used as a callback from the loading component.\n     */\n    loadSnapshot = (snapshot?: Snapshot) => {\n        if (snapshot) {\n            this.subcalc.setSnapshot(snapshot)\n            this.subcalc.snapshot.redistributeDelegates()\n        }\n        this.setState({ present: Presenting.Calculator })\n    }\n\n    /**\n     * Change the meeting name here and in storage.\n     * \n     * NOTE: This is _not_ considered a revision of the snapshot\n     * since the meeting name will apply to all snapshots from this meeting.\n     */\n    setStateName = (name: string) => {\n        this.subcalc.renameMeeting(name)\n        this.forceUpdate()\n    }\n\n    /**\n     * Change the number of delegates allowed here and in storage.\n     */\n    setStateAllowed = (allowed: number) => {\n        this.subcalc.reviseSnapshot({ allowed: allowed })\n        this.forceUpdate()\n    }\n\n    /**\n     * Change the random seed (the \"coin\") here and in storage.\n     */\n    setStateSeed = (seed: number) => {\n        this.subcalc.reviseSnapshot({ seed: seed })\n        this.forceUpdate()\n    }\n\n    /**\n     * Change force and update of the interface and storage\n     * due to changes in the subcaucuses.\n     */\n    setStateSubcaucuses = () => {\n        this.subcalc.reviseSnapshot()\n        this.forceUpdate()\n    }\n\n    /**\n     * Request a new meeting from the storage manager and\n     * set our state to reflect the new meeting.\n     */\n    newMeeting = () => {\n        this.subcalc.newSnapshot()\n        this.setState({\n            present: Presenting.Calculator,\n            cards: this.initialCardState\n        })\n    }\n\n    /**\n     * Request a new meeting from the storage manager and\n     * set our state to reflect the new meeting.\n     */\n    duplicateMeeting = () => {\n        this.subcalc.duplicateSnapshot()\n        this.growlAlert(this.subcalc.snapshot.name, 'success', 'Snapshot Duplicated')\n        this.forceUpdate()\n    }\n\n    /**\n     * Request a new meeting from the storage manager and\n     * set our state to reflect the new meeting.\n     */\n    saveSnapshot = (revision: string) => {\n        this.subcalc.saveSnapshot(revision)\n        this.forceUpdate()\n        this.growlAlert(revision, 'success', 'Snapshot Saved')\n    }\n\n    /**\n     * Provide a default name for this meeting, including today's date.\n     */\n    defaultName = (): string => {\n        return \"Meeting on \" + this.subcalc.snapshot.created.toDate().toLocaleDateString(\"en-US\")\n    }\n\n    /**\n     * Provide a friendly string explaining the `allowed` number.\n     */\n    allowedString = (): string => {\n        return `${this.subcalc.snapshot.allowed} delegates to be elected`\n    }\n\n    /**\n     * Add a card to an array of cards (or to the current state cards\n     * if no array is provided). Note that we do not need to deduplicate\n     * this array since our `removeCard()` method will remove all copies\n     * of the same card anyway.\n     */\n    addCard = (cardFor: CardFor, to?: Array<CardFor>): Array<CardFor> => {\n        if (to === undefined) {\n            to = this.state.cards\n        }\n        return [...to, cardFor]\n    }\n\n    /**\n     * Adds a card to the cards state.\n     */\n    addCardState = (cardFor: CardFor) => {\n        this.setState({ cards: this.addCard(cardFor) })\n    }\n\n    /**\n     * Remove all copies of the given card from the array of cards\n     * (or from the current state cards if not array is provided).\n     */\n    removeCard = (seekingCardFor: CardFor, from?: Array<CardFor>): Array<CardFor> => {\n        if (from === undefined) {\n            from = this.state.cards\n        }\n        return from.filter(foundCardFor => foundCardFor != seekingCardFor)\n    }\n\n    /**\n     * Removes a card from the cards state.\n     */\n    removeCardState = (cardFor: CardFor) => {\n        this.setState({ cards: this.removeCard(cardFor) })\n    }\n\n    /**\n     * Swaps a card in for another card in the cards state.\n     * This can be used to make one card invoke another card.\n     */\n    switchCardState = (fromCardFor: CardFor, toCardFor: CardFor) => {\n        let newCards = this.removeCard(fromCardFor)\n        newCards = this.addCard(toCardFor, newCards)\n        this.setState({ cards: newCards })\n    }\n\n    /**\n     * Returns `true` if the given card is in the cards state.\n     * \n     * NOTE: The card may be one of many waiting to be displayed,\n     * so this may return `true` even when the card is not visible.\n     */\n    showingCard = (cardFor: CardFor): boolean => {\n        return this.state.cards.indexOf(cardFor) > -1\n    }\n\n    /**\n     * Handles changes to the `allowed` and `name` state, but \n     * nothing else. Expects to be called from an input form element.\n     */\n    handleChange = (name: string) => (event: React.FormEvent<HTMLInputElement>) => {\n        switch (name) {\n            case 'allowed':\n                var allowed = Number(event.currentTarget.value)\n                if (allowed < 0) {\n                    allowed = 0\n                }\n                this.setStateAllowed(allowed)\n                break\n            case 'name':\n                this.setStateName(event.currentTarget.value)\n                break\n        }\n    }\n\n    /**\n     * Intended to facilitate focussing on the full text, even on iOS.\n     * However, this was proving problematic and is not currently in use.\n     */\n    focusOnWholeText = () => (event: React.FormEvent<HTMLInputElement>) => {\n        const target = event.currentTarget // event properties must be copied to use async\n        setTimeout(() => target.setSelectionRange(0, 9999), 0) // do this async to try to make Safari behave\n    }\n\n    /**\n     * Used by the `SubcaucusRow` via a callback to update the \n     * subcaucus array here in the app. \n     */\n    handleSubcaucusChange = (subcaucus: Subcaucus, action: SubcaucusRowAction, index?: number, callback?: () => void) => {\n        _u.debug(\"subcaucus changed\", subcaucus.id, subcaucus.debug(), action)\n        switch (action) {\n            case 'enter':\n                if (index) {\n                    _u.debug(\"enter index\", index, \"length\", this.subcalc.snapshot.subcaucuses.length)\n                    if (index === this.subcalc.snapshot.subcaucuses.length\n                        || index === this.subcalc.snapshot.subcaucuses.length * 2) {\n                        this.subcalc.snapshot.addSubcaucus()\n                    }\n                    this.setStateSubcaucuses()\n                    if (callback) {\n                        callback()\n                    }\n\n                }\n                return\n            case 'recalc':\n                // this is a signal to recalculate\n                this.setStateSubcaucuses()\n                return\n        }\n    }\n\n    /**\n     * Removes all empty subcaucuses or just those that are not named.\n     */\n    removeEmpties = (subset: 'all' | 'unnamed' = 'all') => {\n        if (subset == 'all') {\n            this.subcalc.snapshot.subcaucuses.filter((subcaucus, key) => {\n                return subcaucus.count > 0\n            })\n            this.subcalc.reviseSnapshot()\n        }\n        if (subset == 'unnamed') {\n            this.subcalc.snapshot.subcaucuses.filter((subcaucus, k, i) => {\n                _u.debug(\"remove?\", subcaucus.id, subcaucus.count, subcaucus.name, subcaucus.count > 0 || subcaucus.name != '', \"key\", k, \"index\", i)\n                return subcaucus.count > 0 || subcaucus.name != ''\n            })\n        }\n        this.removeCardState(CardFor.RemovingEmpties)\n        this.subcalc.reviseSnapshot()\n    }\n\n    /**\n     * Returns an icon to represent the supplied `SortOrder`.\n     */\n    sortOrderIcon = (order: SortOrder): string => {\n        return [\"pi pi-chevron-circle-down\", \"pi pi-circle-off\", \"pi pi-chevron-circle-up\"][order + 1]\n    }\n\n    /**\n     * Cycles through the sort orders and returns the next one.\n     */\n    nextSortOrder = (currentOrder: SortOrder, direction = 1): SortOrder => {\n        // shifting over with +1 to nudge values over to where modulo is happy\n        let nextOrder = ((currentOrder + direction + 1) % 3)\n        if (nextOrder < 0) {\n            nextOrder += 3 // needed to cycle backwards\n        }\n        // shift back over -1 to align with our sort orders again\n        return nextOrder - 1\n    }\n\n    /**\n     * If the snapshot has been revised, offers a chance to save\n     * the changes before proceeding with the action in the callback.\n     */\n    checkForRevisionBefore = (callback: () => void) => {\n        if (this.subcalc.snapshot.revision == \"\") {\n            this.setState({ afterBefore: callback })\n            this.addCardState(CardFor.SavingSnapshotBefore)\n        } else {\n            callback()\n        }\n    }\n\n    /**\n     * Returns JSX for the menubar.\n     * \n     * NOTE: Do not `setState()` in this method.\n     */\n    renderMenu = (): JSX.Element => {\n        const items = [\n            {\n                label: \"About\",\n                icon: \"pi pi-fw pi-info-circle\",\n                items: [\n                    {\n                        label: \"Minnesota DFL Subcaucus Calculator\",\n                        command: () => this.addCardState(CardFor.ShowingAbout),\n                    },\n                    {\n                        label: \"Instructions\",\n                        command: () => this.addCardState(CardFor.ShowingInstructions),\n                    },\n                    {\n                        label: \"Data Security\",\n                        command: () => this.addCardState(CardFor.ShowingSecurity),\n                    },\n                ]\n            },\n            {\n                label: \"Meetings\",\n                icon: \"pi pi-fw pi-calendar\",\n                items: [\n                    {\n                        label: \"New meeting\",\n                        icon: \"pi pi-fw pi-calendar-plus\",\n                        command: () => this.checkForRevisionBefore(this.newMeeting)\n                    },\n                    {\n                        label: \"Open snapshot\",\n                        icon: \"pi pi-fw pi-folder-open\",\n                        command: () => this.checkForRevisionBefore(() => this.setState({ present: Presenting.Loading }))\n                    },\n                    {\n                        label: \"Save snapshot\",\n                        icon: \"pi pi-fw pi-clock\",\n                        command: () => this.addCardState(CardFor.SavingSnapshot),\n                    },\n                    {\n                        label: \"Duplicate meeting\",\n                        icon: \"pi pi-fw pi-clone\",\n                        command: () => this.checkForRevisionBefore(this.duplicateMeeting)\n                    },\n                    {\n                        label: \"Change the coin\",\n                        icon: \"pi pi-fw pi-refresh\",\n                        command: () => this.addCardState(CardFor.ChangingCoin)\n                    },\n                ]\n            },\n            {\n                label: \"Share\",\n                icon: \"pi pi-fw pi-share-alt\",\n                items: [\n                    {\n                        label: \"Email report\",\n                        icon: \"pi pi-fw pi-envelope\",\n                        command: () => this.growlAlert(\"Email report.\", 'warn', 'TODO')\n                    },\n                    {\n                        label: \"Download text\",\n                        icon: \"pi pi-fw pi-align-left\",\n                        command: () => this.growlAlert(\"Download text.\", 'warn', 'TODO')\n                    },\n                    {\n                        label: \"Download CSV\",\n                        icon: \"pi pi-fw pi-table\",\n                        command: () => this.growlAlert(\"Download csv.\", 'warn', 'TODO')\n                    },\n                    {\n                        label: \"Download code\",\n                        icon: \"pi pi-fw pi-save\",\n                        command: () => this.growlAlert(\"Download code.\", 'warn', 'TODO')\n                    },\n                ]\n            },\n        ]\n        return <Menubar key=\"calculator-menu\" model={items} id=\"app-main-menu\" />\n    }\n\n    /**\n     * Returns JSX for the about card.\n     * \n     * NOTE: Do not `setState()` in this method.\n     */\n    renderAbout = (): JSX.Element => {\n        return (\n            <ValueCard key=\"about-card\" id=\"about-card\"\n                title=\"Minnesota DFL Subcaucus Calculator\"\n                image=\"dfl.jpg\"\n                onSave={() => this.removeCardState(CardFor.ShowingAbout)}\n                extraButtons={\n                    <Button id=\"show-credits-button\"\n                        label=\"Credits\"\n                        icon=\"pi pi-user\"\n                        className=\"p-button-secondary\"\n                        onClick={() => this.switchCardState(CardFor.ShowingAbout, CardFor.ShowingBy)}\n                    />\n                }\n            >\n                <p>Originally written for <a href=\"http://sd64dfl.org\">SD64 DFL</a>, this app assists convenors of precinct caucuses and conventions in Minnesota. The Minnesota Democratic Farmer Labor (DFL) party uses a wonderful, but bit arcane, walking subcaucus process that is simple enough to do, but rather difficult to tabulate.</p>\n                <p>Given the number of delegates your meeting or caucus is allowed to send forward and the count of members of each subcaucus, this calculator determines how many of those delegates each subcaucus will elect. The rules it follows appeared on page 4 of the <a href=\"http://www.sd64dfl.org/more/caucus2014printing/2014-Official-Call.pdf\">DFL 2014 Official Call</a>, including the proper treatment of remainders. It makes the math involved in a walking subcaucus disappear.</p>\n                <p>The app could be used to facilitate a walking subcaucus or <a href=\"https://en.wikipedia.org/wiki/Proportional_representation\">proportional representation</a> system for any group.</p>\n            </ValueCard>\n        )\n    }\n\n    /**\n     * Returns JSX for the instructions card.\n     * \n     * NOTE: Do not `setState()` in this method.\n     */\n    renderInstructions = (): JSX.Element => {\n        return (\n            <ValueCard key=\"instructions-card\" id=\"instructions-card\"\n                title=\"Fill in the subcaucuses\"\n                image=\"walking.jpg\"\n                onSave={() => this.removeCardState(CardFor.ShowingInstructions)}\n            >\n                <p>Now it is time to fill in the subcaucus information. Just add each subcaucus name and the count of participants. Usually a convention or cacucus will solicit the names of subcaucuses first, feel free to enter them right away without a count. Then people will be encouraged to walk around the room and congregate with the subcaucus that most closely represents their views. When each subcacus reports how many members they attracted, you can enter that as the count for that subcaucus.</p>\n                <p>As soon as you start entering subcaucus counts, the calculator will go to work determining how many delegates each subcaucus will be assigned. You can ignore those numbers until you have finished entering and confirming all the subcaucus counts. When you are done, the delegate numbers can be reported to the chair of your convention or caucus.</p>\n                <p>Since most conventions or caucuses will go through more than one round of \"walking\", you can just keep reusing your subcaucus list for each round. However, you might want to consider these steps at the end of each round:</p>\n                <ul>\n                    <li>Use the \"Meetings\" menu at the top to save a snapshot after each round of caucusing. This will give you a good record of the whole process.</li>\n                    <li>Use the \"Share\" menu to email a report about each round to the chair of the meeting just so they also have a clear record of the process.</li>\n                </ul>\n                <p>You can always get these instructions back under the \"About\" menu at the top. Have fun!</p>\n            </ValueCard>\n        )\n    }\n\n    /**\n     * Returns JSX for the security card.\n     * \n     * NOTE: Do not `setState()` in this method.\n     */\n    renderSecurity = (): JSX.Element => {\n        return (\n            <ValueCard key=\"security-card\" id=\"security-card\"\n                title=\"Data security\"\n                image=\"security.jpg\"\n                extraButtons={\n                    <Button id=\"clear-data -button\"\n                        label=\"Clear All Data\"\n                        icon=\"pi pi-exclamation-triangle\"\n                        className=\"p-button-danger\"\n                        onClick={() => this.growlAlert(\"Clear data.\", 'warn', 'TODO')}\n                    />\n                }\n                onSave={() => this.removeCardState(CardFor.ShowingSecurity)}\n            >\n                <p>The subcaucus calculator stores all of the data you enter on your own device. It uses a feature of web browsers called \"local storage\" to save all your meeting information within your web browser. None of your data gets off your device unless you choose to share it.</p>\n                <p>Do note that this app is running on a web server, though, and that server will keep all the logs typical of web servers. This includes logs of your IP address and the documents you retrieve from the server. None of these logs will include your specific meeting information.</p>\n                <p>One thing to be aware of is that anyone using this same browser on this same device will be able to see your meeting information, including saved snapshots and past meetings, when they come to this web site. If this is a public device and you want to clear out all the data the calculator has stored, click the \"Clear All Data\" button.</p>\n                <p>Since the data is stored with your browser on this device, also be aware that you will not be able to see your meeting information from any other browser. This means that even you won't be able to get at this data unless you use the sharing features.</p> {/* TODO: create a transfer data feature */}\n                <p>You can use the \"Share\" menu to get data off your device when you need to do so. Once you share your meeting information this calculator is no longer in control of that data. Make good choices about sharing.</p>\n                <p>The good news is that there really isn't any private information in the calculator in the first place. Most meetings that use the walking subcacus process are public meetings and the data you store in this calculator is not sensitive. Still, we thought you'd like to know we treat it as <em>your</em> data and do not share it unless you ask us to.</p>\n            </ValueCard>\n        )\n    }\n\n    /**\n     * Returns JSX for the byline credit card.\n     * \n     * NOTE: Do not `setState()` in this method.\n     */\n    renderBy = (): JSX.Element => {\n        return (\n            <ValueCard key=\"by-card\" id=\"by-card\"\n                title=\"Brought to you by Tenseg LLC\"\n                image=\"tenseg.jpg\"\n                onSave={() => this.removeCardState(CardFor.ShowingBy)}\n            >\n                <p>We love the walking subcaucus process and it makes us a bit sad that the squirrelly math required to calculate who gets how many delegate discourages meetings and caucuses from using the process. We hope this calculator makes it easier for you to get to know your neighbors as you work together to change the world!</p>\n                <p>Please check us out at <a href=\"https://tenseg.net\">tenseg.net</a> if you need help building a website or making appropriate use of technology.</p>\n            </ValueCard>\n        )\n    }\n\n    /**\n     * Returns JSX for the welcome card, which is a special version\n     * of the card to enter a name for the meeting.\n     * \n     * NOTE: Do not `setState()` in this method.\n     */\n    renderWelcomeAndSetName = (): JSX.Element => {\n        return (\n            <ValueCard key=\"welcome-card\" id=\"welcome-card\"\n                title=\"Welcome to the Minnesota DFL Subcacus Calculator\"\n                image=\"dfl.jpg\"\n                description='Please start by specifying the name of your meeting here. Most meetings have a name, like the \"Ward 4 Precinct 7 Caucus\" or the \"Saint Paul City Convention\".'\n                value={this.subcalc.snapshot.name}\n                defaultValue={this.defaultName()}\n                allowEmpty={false}\n                onSave={(value?: string) => {\n                    if (value == undefined) {\n                        this.removeCardState(CardFor.WelcomeAndSetName)\n                    } else {\n                        this.setState({ cards: this.removeCard(CardFor.WelcomeAndSetName) })\n                        this.setStateName(value)\n                    }\n                }}\n            />\n        )\n    }\n\n    /**\n     * Returns JSX for the card to change a meeting's name.\n     * \n     * NOTE: Do not `setState()` in this method.\n     */\n    renderChangingName = (): JSX.Element => {\n        return (\n            <ValueCard key=\"name-value\" id=\"name-value\"\n                title=\"Meeting name?\"\n                value={this.subcalc.snapshot.name}\n                defaultValue={this.defaultName()}\n                allowEmpty={false}\n                extraButtons={this.subcalc.snapshot.name\n                    ? <Button id=\"new-meeting-button\"\n                        label=\"New meeting\"\n                        icon=\"pi pi-calendar-plus\"\n                        className=\"p-button-secondary\"\n                        onClick={() => this.growlAlert(\"New meeting.\", 'warn', 'TODO')}\n                    />\n                    : <></>\n                }\n                onSave={(value?: string) => {\n                    if (value == undefined) {\n                        this.removeCardState(CardFor.ChangingName)\n                    } else {\n                        this.setState({ cards: this.removeCard(CardFor.ChangingName) })\n                        this.setStateName(value)\n                    }\n                }}\n            >\n                <p>You can save a new name for this meeting or, if this is really a new event, you may want to start a new meeting altogether.</p>\n            </ValueCard>\n        )\n    }\n\n    /**\n     * Returns JSX for the card to save a \n     * snapshot of the current state of the\n     * calculator.\n     * \n     * NOTE: Do not `setState()` in this method.\n     */\n    renderSavingSnapshot = (): JSX.Element => {\n        return (\n            <ValueCard key=\"snapshot-value\" id=\"snapshot-value\"\n                title=\"Name for the snapshot?\"\n                value=\"\"\n                defaultValue={`Revision of ${this.subcalc.snapshot.name}`}\n                allowEmpty={false}\n                extraButtons={\n                    <Button id=\"cancel-save-snapshot-button\"\n                        label=\"Cancel\"\n                        icon=\"pi pi-times\"\n                        className=\"p-button-secondary\"\n                        onClick={() => this.removeCardState(CardFor.SavingSnapshot)}\n                    />\n                }\n                onSave={(value?: string) => {\n                    this.removeCardState(CardFor.SavingSnapshot)\n                    if (value) {\n                        this.saveSnapshot(value)\n                    }\n                }}\n            >\n                <p>Consider names like \"First walk\" or \"Final result\".\n                {this.subcalc.snapshot.allowed\n                        ? <span> If this is actually a new event, you may want to start a new meeting instead</span>\n                        : <></>\n                    }\n                </p>\n            </ValueCard>\n        )\n    }\n\n    /**\n     * Returns JSX for the card to save a \n     * snapshot of the current state of the\n     * calculator before loading another snapshot.\n     * \n     * NOTE: Do not `setState()` in this method.\n     */\n    renderSavingSnapshotBefore = (): JSX.Element => {\n        return (\n            <ValueCard key=\"snapshot-value\" id=\"snapshot-value\"\n                title=\"Save changes?\"\n                value=\"\"\n                defaultValue={`Revision of ${this.subcalc.snapshot.revision || this.subcalc.snapshot.name}`}\n                allowEmpty={false}\n                extraButtons={\n                    <>\n                        <Button id=\"just-load-snapshot-button\"\n                            label=\"Don't save\"\n                            icon=\"pi pi-folder-open\"\n                            className=\"p-button-warning\"\n                            onClick={() => {\n                                this.removeCardState(CardFor.SavingSnapshotBefore)\n                                if (this.state.afterBefore) {\n                                    this.state.afterBefore()\n                                }\n                            }}\n                        />\n                        <Button id=\"cancel-save-and-load-snapshot-button\"\n                            label=\"Cancel\"\n                            icon=\"pi pi-times\"\n                            className=\"p-button-secondary\"\n                            onClick={() => this.removeCardState(CardFor.SavingSnapshotBefore)}\n                        />\n                    </>\n                }\n                onSave={(value?: string) => {\n                    this.removeCardState(CardFor.SavingSnapshotBefore)\n                    if (value) {\n                        this.saveSnapshot(value)\n                        if (this.state.afterBefore) {\n                            this.state.afterBefore()\n                        }\n                    }\n                }}\n            >\n                <p>It looks like you have changed something. Do you want to save a snapshot? If so, provide a name like \"First walk\" or \"Final result\". If you don't save a snapshot your changes may be lost when you open a past snapshot.\n                </p>\n            </ValueCard>\n        )\n    }\n\n    nextStepLoading = () => {\n        this.setState({ present: Presenting.Loading })\n    }\n\n    /**\n     * Returns JSX for the card to change the \n     * number of delegates allowed from a meeting.\n     * \n     * NOTE: Do not `setState()` in this method.\n     */\n    renderChangingDelegates = (): JSX.Element => {\n        return (\n            <ValueCard key=\"delegate-value\" id=\"delegate-value\"\n                title=\"Number of delegates allowed?\"\n                type=\"positive integer\"\n                value={this.subcalc.snapshot.allowed.toString()}\n                allowEmpty={false}\n                extraButtons={this.subcalc.snapshot.allowed\n                    ? <Button id=\"new-meeting-button\"\n                        label=\"New meeting\"\n                        icon=\"pi pi-calendar-plus\"\n                        className=\"p-button-secondary\"\n                        onClick={() => this.growlAlert(\"New meeting.\", 'warn', 'TODO')}\n                    />\n                    : <></>\n                }\n                onSave={(value?: string) => {\n                    if (value == undefined) {\n                        this.removeCardState(CardFor.ChangingDelegates)\n                    } else {\n                        this.setState({ cards: this.removeCard(CardFor.ChangingDelegates) })\n                        this.setStateAllowed(Number(value))\n                    }\n                }}\n            >\n                <p>Specify the number of delegates that your meeting or caucus is allowed to send on to the next level. This is the number of delegates to be elected by your meeting.\n                {this.subcalc.snapshot.allowed\n                        ? <span> If this is actually a new event, you may want to start a new meeting instead</span>\n                        : <></>\n                    }\n                </p>\n            </ValueCard>\n        )\n    }\n\n    /**\n     * Returns JSX for the card to change the \n     * coin (or random seed) of a meeting.\n     * \n     * NOTE: Do not `setState()` in this method.\n     */\n    renderChangingCoin = (): JSX.Element => {\n        return (\n            <ValueCard key=\"coin-value\" id=\"coin-value\"\n                title={\"Change the coin\"}\n                type=\"positive integer\"\n                value={this.subcalc.snapshot.seed.toString()}\n                allowEmpty={false}\n                extraButtons={this.subcalc.snapshot.allowed\n                    ? <Button id=\"random-coin-button\"\n                        label=\"Generate random coin\"\n                        icon=\"pi pi-refresh\"\n                        className=\"p-button-success\"\n                        onClick={() => {\n                            this.subcalc.reviseSnapshot({ seed: _u.randomSeed() })\n                            this.growlAlert(`Random seed is now ${this.subcalc.snapshot.seed}.`, 'success', 'New Random Coin')\n                            this.removeCardState(CardFor.ChangingCoin)\n                        }}\n                    />\n                    : <></>\n                }\n                onSave={(value?: string) => {\n                    if (value == undefined) {\n                        this.removeCardState(CardFor.ChangingCoin)\n                    } else {\n                        const seed = Number(value)\n                        if (seed === this.subcalc.snapshot.seed) {\n                            this.growlAlert(`Random seed is still ${this.subcalc.snapshot.seed}.`, 'info', 'Coin not changed')\n                        } else {\n                            this.subcalc.reviseSnapshot({ seed: seed })\n                            this.growlAlert(`Random seed is now ${this.subcalc.snapshot.seed}.`, 'success', 'New Chosen Coin')\n                        }\n                        this.removeCardState(CardFor.ChangingCoin)\n                    }\n                }}\n            >\n                <p>\n                    Traditionally, when there are delegates remaining to be assigned and\n                    two subcaucuses are \"tied\" with the same size delegations, the chair\n                    of the caucus will use some method of assigning those remaining delegates\n                    at random. These methods include coin-flips or drawing lots.\n                </p>\n                <p>\n                    In this calculator we accomplish the same randomness, but we do so by\n                    in essence, flipping a coin in secret ahead of time. The \"coin\" is\n                    really a \"random seed\" that ensures fair but unpredictable results.\n                </p>\n                <p>\n                    If you change the coin, this pattern of random flips will also change.\n                    If want the same results as someone else is getting in their copy of\n                    the calculator, then you must share the same coin value.\n                </p>\n            </ValueCard>\n        )\n    }\n\n    /**\n     * Returns JSX for the card that allows the user to\n     * back out of removing empty subcaucuses.\n     * \n     * NOTE: Do not `setState()` in this method.\n     */\n    renderRemovingEmpties = (): JSX.Element => {\n        return (\n            <ValueCard key=\"remove-empties-card\" id=\"remove-empties-card\"\n                title=\"Remove empty subcaucuses\"\n                footer={\n                    <>\n                        <Button id=\"remove-all-empties-button\"\n                            label=\"Remove All Empties\"\n                            icon=\"pi pi-trash\"\n                            onClick={() => this.removeEmpties()}\n                        />\n                        <Button id=\"remove-some-empties-button\"\n                            label=\"Remove Only Unnamed\"\n                            icon=\"pi pi-trash\"\n                            className=\"p-button-warning\"\n                            onClick={() => this.removeEmpties('unnamed')}\n                        />\n                        <Button id=\"cancel-remove-button\"\n                            label=\"Cancel\"\n                            icon=\"pi pi-times\"\n                            className=\"p-button-secondary\"\n                            onClick={() => this.removeCardState(CardFor.RemovingEmpties)}\n                        />\n                    </>\n                }\n            >\n                <p>An \"empty\" subcaucus is one with no participants &mdash; a zero count.</p>\n                <p>You can choose to remove all empty subcaucuses, or only those which also have no names.</p>\n            </ValueCard>\n        )\n    }\n\n    /**\n     * Returns JSX next card to be displayed from the cards state.\n     * Returns and empty JSX element if there are no cards waiting.\n     * \n     * This function sorts the cards array so that highest priority\n     * cards are displayed first.\n     * \n     * NOTE: Please be sure to add any new `CardFor` values as \n     * cases in this function. Do not `setState()` in this method.\n     */\n    renderNextCard = (): JSX.Element => {\n        return this.state.cards.sort((a, b) => b - a).reduce((accumulator: JSX.Element, cardFor: CardFor): JSX.Element => {\n            _u.debug(\"filtering cards\", accumulator, cardFor)\n            switch (cardFor) {\n                case CardFor.WelcomeAndSetName: return this.renderWelcomeAndSetName()\n                case CardFor.ShowingInstructions: return this.renderInstructions()\n                case CardFor.ShowingAbout: return this.renderAbout()\n                case CardFor.ShowingBy: return this.renderBy()\n                case CardFor.SavingSnapshotBefore: return this.renderSavingSnapshotBefore()\n                case CardFor.SavingSnapshot: return this.renderSavingSnapshot()\n                case CardFor.ChangingName: return this.renderChangingName()\n                case CardFor.ChangingDelegates: return this.renderChangingDelegates()\n                case CardFor.ChangingCoin: return this.renderChangingCoin()\n                case CardFor.RemovingEmpties: return this.renderRemovingEmpties()\n                case CardFor.ShowingSecurity: return this.renderSecurity()\n            }\n            return accumulator\n        }, <></>)\n    }\n\n    /**\n     * A method to sort subcaucuses by name.\n     * \n     * NOTE: This depends on the `sortName` state to determine\n     * whether the result will be ascending or descending.\n     */\n    sortBySubcaucusName = (a: Subcaucus, b: Subcaucus): number => {\n\n        // fall back to order of entry\n        let comparison = a.id - b.id\n        const nameA = a.displayName().toUpperCase()\n        const nameB = b.displayName().toUpperCase()\n        if (nameA < nameB) {\n            comparison = -1\n        }\n        if (nameA > nameB) {\n            comparison = 1\n        }\n        return comparison * this.state.sortName\n    }\n\n    /**\n     * A method to sort subcaucuses by count.\n     * This method sorts first by count, then subsorts by\n     * the number of delegates, and then sorts by name\n     * (names will always be ascending). It also makes sure\n     * that subcaucuses without any members will sort to\n     * the bottom regardless of the chosen sort order.\n     * \n     * NOTE: This depends on the `sortCount` state to determine\n     * whether the result will be ascending or descending.\n     */\n    sortBySubcaucusCounts = (a: Subcaucus, b: Subcaucus): number => {\n\n        // start with delegates, then check on count, then fall back if needed\n        const delegateComparison = (a.delegates - b.delegates).comparisonValue()\n\n        let ac = a.count ? a.count : this.state.sortCount * Infinity\n        let bc = b.count ? b.count : this.state.sortCount * Infinity\n        const countComparison = (ac - bc).comparisonValue()\n\n\n        const weightedComparison = (0.1 * delegateComparison) + countComparison\n\n        let comparison = weightedComparison\n\n        if (comparison == 0) {\n            // we want the names to always sort in descending order\n            // during count comparisons, so we undo the effect of direction\n            // (both 1 * 1 and -1 * -1 equal 1) and then force a -1 direction \n            comparison = this.sortBySubcaucusName(a, b) * this.state.sortName * -1\n        }\n\n        return comparison * this.state.sortCount\n    }\n\n    /**\n     * Returns JSX for the subcaucus rows.\n     * \n     * NOTE: Do not `setState()` in this method.\n     */\n    renderSubcaucusRows = (): JSX.Element[] => {\n        // sort subcaucuses by id number by default\n        let sort = (a: Subcaucus, b: Subcaucus) => {\n            return a.id - b.id\n        }\n\n        if (this.state.sortName != SortOrder.None) {\n            sort = this.sortBySubcaucusName\n        }\n\n        if (this.state.sortCount != SortOrder.None) {\n            sort = this.sortBySubcaucusCounts\n        }\n\n        return this.subcalc.snapshot.subcaucuses.values().sort(sort).map((subcaucus, index, array): JSX.Element => {\n            return (\n                <SubcaucusRow key={`${subcaucus.id}`}\n                    subcaucus={subcaucus}\n                    index={index + 1}\n                    rows={array.length}\n                    exchange={this.handleSubcaucusChange}\n                />\n            )\n        })\n    }\n\n    /**\n     * Returns JSX for the summary section of the SubCalc App.\n     * \n     * NOTE: Do not `setState()` in this method.\n     */\n    renderSummary = (): JSX.Element => {\n        return ((this.subcalc.snapshot.room > 0)\n            ? <div id=\"summary-container\">\n                <div className=\"summary-row\">\n                    <div className=\"summary-label\">\n                        Total participants and delegates elected\n                    </div>\n                    <div className=\"summary-count\">\n                        <strong>\n                            {this.subcalc.snapshot.room.toCommaString()}\n                        </strong>\n                    </div>\n                    <div className=\"summary-delegates\">\n                        {this.subcalc.snapshot.totalDelegates.toCommaString()}\n                    </div>\n                </div>\n                <div className=\"summary-row\">\n                    <div className=\"summary-label\">\n                        Minimum of <strong>{this.subcalc.snapshot.wholeViability.singularPlural(\"member\", \"members\")}</strong> needed to make a subcaucus viable\n                    </div>\n                </div>\n                <div className=\"summary-row\">\n                    <div className=\"summary-label\">\n                        Viability number\n                    </div>\n                    <div className=\"summary-count\">\n                        <strong>\n                            {this.subcalc.snapshot.viability.decimalPlaces(3)}\n                        </strong>\n                    </div>\n                </div>\n                {this.subcalc.snapshot.viableRoom < this.subcalc.snapshot.room\n                    ? <div className=\"summary-row clickable\"\n                        onClick={() => this.growlAlert(\"Explain viability in more detail.\", 'warn', 'TODO')}\n                    >\n                        <div className=\"summary-label\">\n                            Recalculated viability number ({(this.subcalc.snapshot.room - this.subcalc.snapshot.viableRoom).singularPlural(\"person\", \"people\")} in non-viable subcaucuses)\n                        </div>\n                        <div className=\"summary-count\">\n                            {this.subcalc.snapshot.delegateViability.decimalPlaces(3)}\n                        </div>\n                    </div>\n                    : ''\n                }\n            </div>\n            : <div id=\"summary-container\">\n                <div className=\"summary-row\">\n                    <div className=\"summary-label\">\n                        To get an initial \"viability number\" just make all the people in the room members of a single subcaucus.\n                    </div>\n                </div>\n            </div>\n        )\n    }\n\n    /**\n     * Returns JSX for the whole calculator.\n     * \n     * NOTE: Do not `setState()` in this method.\n     */\n    renderCalculator = (): JSX.Element => {\n        const { sortName, sortCount } = this.state\n        const snapshot = this.subcalc.snapshot\n        const { name, revision } = snapshot\n\n        return (\n            <div id=\"calculator\">\n                {this.renderMenu()}\n                <div id=\"meeting-info\">\n                    <div id=\"meeting-name\" className=\"button\"\n                        onClick={() => this.addCardState(CardFor.ChangingName)}\n                    >\n                        {name ? name : this.defaultName()}\n                        {revision != ''\n                            ? <span className=\"snapshot\">\n                                {revision}\n                            </span>\n                            : ''\n                        }\n                    </div>\n                    <div id=\"delegates-allowed\" className=\"button\"\n                        onClick={() => this.addCardState(CardFor.ChangingDelegates)}\n                    >{this.allowedString()}</div>\n                </div>\n                <div id=\"subcaucus-container\">\n                    <div id=\"subcaucus-header\">\n                        <Button id=\"subcaucus-name-head\"\n                            label=\"Subcaucuses\"\n                            icon={this.sortOrderIcon(sortName)}\n                            onClick={() => this.setState({\n                                sortName: this.state.sortName ? SortOrder.None : SortOrder.Ascending,\n                                sortCount: SortOrder.None\n                            })}\n                        />\n                        <Button id=\"subcaucus-count-head\"\n                            label=\"Members\"\n                            iconPos=\"right\"\n                            icon={this.sortOrderIcon(sortCount)}\n                            onClick={() => this.setState({\n                                sortName: SortOrder.None,\n                                sortCount: this.nextSortOrder(sortCount, -1)\n                            })}\n                        />\n                        <Button id=\"subcaucus-delegate-head\"\n                            label=\"Dels\"\n                        />\n                    </div>\n                    <div id=\"subcaucus-list\">\n                        {this.renderSubcaucusRows()}\n                    </div>\n                    <div id=\"subcaucus-footer\">\n                        <Button id=\"add-subcaucus-button\"\n                            label=\"Add a Subcaucus\"\n                            icon=\"pi pi-plus\"\n                            onClick={() => {\n                                snapshot.addSubcaucus()\n                                this.setStateSubcaucuses()\n                            }}\n                        />\n                        <Button id=\"remove-empty-subcaucuses-button\"\n                            label=\"Remove Empties\"\n                            icon=\"pi pi-trash\"\n                            onClick={() => this.addCardState(CardFor.RemovingEmpties)}\n                        />\n                        <Button id=\"clear-counts-button\"\n                            icon=\"pi pi-minus-circle\"\n                            onClick={() => this.checkForRevisionBefore(() => {\n                                this.subcalc.zeroSubcaucuses()\n                                this.forceUpdate()\n                            })}\n                        />\n                        {_u.isDebugging()\n                            ? <Button id=\"random-coin-button\"\n                                icon=\"pi pi-refresh\"\n                                className=\"p-button-success\"\n                                onClick={() => {\n                                    this.subcalc.reviseSnapshot({ seed: _u.randomSeed() })\n                                    this.growlAlert(`Random seed is now ${this.subcalc.snapshot.seed}.`, 'success', 'New Random Coin')\n                                    this.forceUpdate()\n                                }}\n                            />\n                            : ''\n                        }\n                    </div>\n                </div>\n                {this.renderSummary()}\n            </div>\n        )\n    }\n\n    /**\n     * Returns the JSX for the footer elements of the app.\n     * \n     * NOTE: Do not `setState()` in this method.\n     */\n    renderByline = (): JSX.Element => {\n        return (\n            <Button id=\"app-byline\"\n                label=\"Brought to you by Tenseg LLC\"\n                href=\"https://tenseg.net\"\n                onClick={() => this.addCardState(CardFor.ShowingBy)}\n            />\n        )\n    }\n\n    /**\n     * Returns the JSX for debugging elements. These should not be\n     * displayed when compiled for production.\n     * \n     * NOTE: Do not `setState()` in this method.\n     */\n    renderDebuggingInfo = (): JSX.Element => {\n\n        if (!_u.isDebugging()) return <></>\n\n        return (\n            <div key={_u.randomSeed()} className=\"debugging\">\n                <p>This is debugging info for <a href=\"https://grand.clst.org:3000/tenseg/subcalc-pr/issues\" target=\"_repository\">subcalc-pr</a> (with <a href=\"https://reactjs.org/docs/react-component.html\" target=\"_react\">ReactJS</a>, <a href=\"https://www.primefaces.org/primereact/\" target=\"_primereact\">PrimeReact</a>, <a href=\"https://www.primefaces.org/primeng/#/icons\" target=\"_primeicons\">PrimeIcons</a>) derrived from <a href=\"https://bitbucket.org/tenseg/subcalc-js/src\" target=\"_bitbucket\">subcalc-js</a>.\n                </p>\n                <pre>{this.subcalc.snapshot.asText()}</pre>\n                <div className=\"columns\">\n                    <div className=\"column\">\n                        <pre>{\"rendered App \" + (new Date()).toLocaleTimeString()}</pre>\n                        <pre>{\"subcalc: \" + this.subcalc.debug()}</pre>\n                        <ShowJSON name=\"this.state\" data={this.state} /><br />\n                    </div>\n                    <div className=\"column\">\n                        <ShowJSON name=\"this.subcalc\" data={this.subcalc} />\n                    </div>\n                </div>\n                <p style={{ clear: \"both\" }}>Done.</p>\n            </div>\n        )\n    }\n\n    /**\n     * Shows an alert using PrimeReact `Growl` if it is available,\n     * or simply as an alert if there is not growl instance yet.\n     */\n    growlAlert = (message: string, severity: 'error' | 'warn' | 'success' | 'info' = 'error', summary = '') => {\n        if (!summary && message) {\n            summary = message\n            message = ''\n        }\n        if (this.growl) {\n            this.growl.show({\n                severity: severity,\n                summary: summary,\n                closable: false,\n                detail: message\n            });\n        } else {\n            alert(message)\n        }\n    }\n\n    /**\n     * Returns the JSX for the whole SubCalc App.\n     */\n    render() {\n\n        _u.debug(\"rendering\", this.subcalc.snapshot)\n\n        return (\n            <div id=\"app\">\n                <div id=\"app-content\">\n                    {this.state.present == Presenting.Calculator\n                        ? this.renderCalculator()\n                        : ''}\n                    {this.state.present == Presenting.Loading\n                        ? <Loader\n                            subcalc={this.subcalc}\n                            onLoad={this.loadSnapshot}\n                            onNew={this.newMeeting}\n                        />\n                        : ''}\n                    {this.renderByline()}\n                    {this.renderNextCard()}\n                    <Growl ref={(el) => this.growl = el} />\n                </div>\n                {this.renderDebuggingInfo()}\n            </div>\n        )\n    }\n}\n","import * as React from 'react'\n// see https://www.npmjs.com/package/react-json-view\n// import ReactJson from 'react-json-view'\n// see: https://www.npmjs.com/package/react-json-tree\n// import JSONTree from 'react-json-tree'\n// local to this app\nimport * as _u from './Utilities'\n\ninterface Props {\n\tname?: string\n\tdata: any\n}\n\ninterface State {\n}\n\nexport class ShowJSON extends React.Component<Props, State> {\n\n\trender() {\n\t\t// react-json-view version, buggy after recalculations\n\t\t// return (\n\t\t// \t<ReactJson\n\t\t// \t\tsrc={this.props.data}\n\t\t// \t\tname={this.props.name}\n\t\t// \t\tenableClipboard={false}\n\t\t// \t\tindentWidth={2}\n\t\t// \t/>\n\t\t// )\n\t\t// simple version...\n\t\tconst jsonString = JSON.stringify(this.props.data, null, 2)\n\t\treturn (\n\t\t\t<div className=\"show-json\">\n\t\t\t\t<pre>\n\t\t\t\t\t{this.props.name ? `${this.props.name} = ` : ''}\n\t\t\t\t\t{jsonString}\n\t\t\t\t</pre>\n\t\t\t</div>\n\t\t)\n\t}\n}\n","// tslint:disable:no-console\n// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the 'N+1' visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL!,\n      window.location.toString()\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (!isLocalhost) {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      } else {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker) {\n          installingWorker.onstatechange = () => {\n            if (installingWorker.state === 'installed') {\n              if (navigator.serviceWorker.controller) {\n                // At this point, the old content will have been purged and\n                // the fresh content will have been added to the cache.\n                // It's the perfect time to display a 'New content is\n                // available; please refresh.' message in your web app.\n                console.log('New content is available; please refresh.');\n              } else {\n                // At this point, everything has been precached.\n                // It's the perfect time to display a\n                // 'Content is cached for offline use.' message.\n                console.log('Content is cached for offline use.');\n              }\n            }\n          };\n        }\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type')!.indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { App } from './App';\nimport registerServiceWorker from './registerServiceWorker';\nimport './index.css';\n\nReactDOM.render(\n  <App />,\n  document.getElementById('root') as HTMLElement\n);\nregisterServiceWorker();\n"],"sourceRoot":""}